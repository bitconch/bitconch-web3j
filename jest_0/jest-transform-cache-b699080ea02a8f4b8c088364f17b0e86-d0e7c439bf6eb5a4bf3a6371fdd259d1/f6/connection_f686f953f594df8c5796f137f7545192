d15a96500bffc2a1ea264364e93aca37
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Connection = void 0;

var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _assert = _interopRequireDefault(require("assert"));

var _url = require("url");

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

var _browser = _interopRequireDefault(require("jayson/lib/client/browser"));

var _superstruct = require("superstruct");

var _rpcWebsockets = require("rpc-websockets");

var _timing = require("./timing");

var _pubkey = require("./pubkey");

var _transactionController = require("./transaction-controller");

var _sleep = require("./util/sleep");

function createRpcReq(url) {
  var server = (0, _browser["default"])(
  /*#__PURE__*/
  function () {
    var _ref = (0, _asyncToGenerator2["default"])(
    /*#__PURE__*/
    _regenerator["default"].mark(function _callee(request, callback) {
      var options, res, text;
      return _regenerator["default"].wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              options = {
                method: 'POST',
                body: request,
                headers: {
                  'Content-Type': 'application/json'
                }
              };
              _context.prev = 1;
              _context.next = 4;
              return (0, _nodeFetch["default"])(url, options);

            case 4:
              res = _context.sent;
              _context.next = 7;
              return res.text();

            case 7:
              text = _context.sent;
              callback(null, text);
              _context.next = 14;
              break;

            case 11:
              _context.prev = 11;
              _context.t0 = _context["catch"](1);
              callback(_context.t0);

            case 14:
            case "end":
              return _context.stop();
          }
        }
      }, _callee, null, [[1, 11]]);
    }));

    return function (_x, _x2) {
      return _ref.apply(this, arguments);
    };
  }());
  return function (method, args) {
    return new Promise(function (resolve, reject) {
      server.request(method, args, function (err, response) {
        if (err) {
          reject(err);
          return;
        }

        resolve(response);
      });
    });
  };
}
/**
 * Expected JSON RPC response for the "fetchAccountBalance" message
 */


var FetchBalanceRpcResult = (0, _superstruct.struct)({
  jsonrpc: _superstruct.struct.literal('2.0'),
  id: 'string',
  error: 'any?',
  result: 'number?'
});
var FetchReputationRpcResult = (0, _superstruct.struct)({
  jsonrpc: _superstruct.struct.literal('2.0'),
  id: 'string',
  error: 'any?',
  result: 'number?'
});
/**
 * @private
 */

function jsonRpcResult(resultDescription) {
  var jsonRpcVersion = _superstruct.struct.literal('2.0');

  return _superstruct.struct.union([(0, _superstruct.struct)({
    jsonrpc: jsonRpcVersion,
    id: 'string',
    error: 'any'
  }), (0, _superstruct.struct)({
    jsonrpc: jsonRpcVersion,
    id: 'string',
    error: 'null?',
    result: resultDescription
  })]);
}
/**
 * @private
 */


var AccountDetailResult = (0, _superstruct.struct)({
  executable: 'boolean',
  owner: 'array',
  difs: 'number',
  reputations: 'number',
  data: 'array'
});
/**
 * Expected JSON RPC response for the "fetchAccountDetail" message
 */

var fetchAccountDetailRpcResult = jsonRpcResult(AccountDetailResult);
/***
 * Expected JSON RPC response for the "accountNotification" message
 */

var AccountNoticeResult = (0, _superstruct.struct)({
  subscription: 'number',
  result: AccountDetailResult
});
/**
 * @private
 */

var ControllerAccountDetailResult = (0, _superstruct.struct)(['string', AccountDetailResult]);
/***
 * Expected JSON RPC response for the "controllerNotification" message
 */

var ControllerAccountNoticeResult = (0, _superstruct.struct)({
  subscription: 'number',
  result: ControllerAccountDetailResult
});
/**
 * Expected JSON RPC response for the "confmTxn" message
 */

var ConfmTxnRpcResult = jsonRpcResult('boolean');
/**
 * Expected JSON RPC response for the "fetchRoundLeader" message
 */

var FetchRoundLeader = jsonRpcResult('string');
/**
 * Expected JSON RPC response for the "fetchClusterNodes" message
 */

var GetClusterNodes = jsonRpcResult(_superstruct.struct.list([(0, _superstruct.struct)({
  pubkey: 'string',
  gossip: 'string',
  tpu: _superstruct.struct.union(['null', 'string']),
  rpc: _superstruct.struct.union(['null', 'string'])
})]));
/**
 * @ignore
 */

var GetClusterNodes_015 = jsonRpcResult(_superstruct.struct.list([(0, _superstruct.struct)({
  id: 'string',
  gossip: 'string',
  tpu: _superstruct.struct.union(['null', 'string']),
  rpc: _superstruct.struct.union(['null', 'string'])
})]));
/**
 * Expected JSON RPC response for the "getEpochVoteAccounts" message
 */

var GetEpochVoteAccounts = jsonRpcResult(_superstruct.struct.list([(0, _superstruct.struct)({
  votePubkey: 'string',
  nodePubkey: 'string',
  stake: 'number',
  commission: 'number'
})]));
/**
 * Expected JSON RPC response for the "fetchSignatureState" message
 */

var FetchSignatureStateRpcResult = jsonRpcResult(_superstruct.struct.union(['null', _superstruct.struct.union([(0, _superstruct.struct)({
  Ok: 'null'
}), (0, _superstruct.struct)({
  Err: 'object'
})])]));
/**
 * Expected JSON RPC response for the "fetchTxnAmount" message
 */

var FetchTxnAmountRpcResult = jsonRpcResult('number');
/**
 * Expected JSON RPC response for the "getTotalSupply" message
 */

var GetTotalSupplyRpcResult = jsonRpcResult('number');
/**
 * Expected JSON RPC response for the "fetchRecentBlockhash" message
 */

var FetchRecentBlockhash = jsonRpcResult(['string', (0, _superstruct.struct)({
  difsPerSignature: 'number',
  maxDifsPerSignature: 'number',
  minDifsPerSignature: 'number',
  targetDifsPerSignature: 'number',
  targetSignaturesPerSlot: 'number'
})]);
/**
 * @ignore
 */

var GetRecentBlockhash_015 = jsonRpcResult(['string', (0, _superstruct.struct)({
  difsPerSignature: 'number'
})]);
/**
 * Expected JSON RPC response for the "reqDrone" message
 */

var ReqDroneRpcResult = jsonRpcResult('string');
/**
 * Expected JSON RPC response for the "reqDrone1" message
 */

var ReqDrone1RpcResult = jsonRpcResult('string');
/**
 * Expected JSON RPC response for the "sendTxn" message
 */

var SendTxnRpcResult = jsonRpcResult('string');
/**
 * Information describing an account
 *
 * @typedef {Object} AccountDetail
 * @property {number} difs Number of difs assigned to the account
 * @property {PubKey} owner Identifier of the controller that owns the account
 * @property {?Buffer} data Optional data assigned to the account
 * @property {boolean} executable `true` if this account's data contains a loaded controller
 */

// This type exists to workaround an esdoc parse error

/**
 * A connection to a fullnode JSON RPC endpoint
 */
var Connection =
/*#__PURE__*/
function () {
  /**
   * Establish a JSON RPC connection
   *
   * @param endpoint URL to the fullnode JSON RPC endpoint
   */
  function Connection(endpoint) {
    (0, _classCallCheck2["default"])(this, Connection);
    (0, _defineProperty2["default"])(this, "_rpcReq", void 0);
    (0, _defineProperty2["default"])(this, "_rpcWebSock", void 0);
    (0, _defineProperty2["default"])(this, "_rpcWebSockConnected", false);
    (0, _defineProperty2["default"])(this, "_blockhashInfo", void 0);
    (0, _defineProperty2["default"])(this, "_disableBlockhashCaching", false);
    (0, _defineProperty2["default"])(this, "_accountChangeSubscriptions", {});
    (0, _defineProperty2["default"])(this, "_accountChangeSubscriptionCounter", 0);
    (0, _defineProperty2["default"])(this, "_controllerAccountChangeSubscriptions", {});
    (0, _defineProperty2["default"])(this, "_controllerAccountChangeSubscriptionCounter", 0);
    var url = (0, _url.parse)(endpoint);
    this._rpcReq = createRpcReq(url.href);
    this._blockhashInfo = {
      recentPackagehash: null,
      seconds: -1,
      transactionSignatures: []
    };
    url.protocol = url.protocol === 'https:' ? 'wss:' : 'ws:';
    url.host = '';
    url.port = String(Number(url.port) + 1);

    if (url.port === '1') {
      url.port = url.protocol === 'wss:' ? '8901' : '8900';
    }

    this._rpcWebSock = new _rpcWebsockets.Client((0, _url.format)(url), {
      autoconnect: false,
      max_reconnects: Infinity
    });

    this._rpcWebSock.on('open', this._wsOnOpen.bind(this));

    this._rpcWebSock.on('error', this._wsOnErr.bind(this));

    this._rpcWebSock.on('close', this._wsOnClose.bind(this));

    this._rpcWebSock.on('accountNotification', this._wsOnAccountNotice.bind(this));

    this._rpcWebSock.on('controllerNotification', this._wsOnProgramAccountNotification.bind(this));
  }
  /**
   * Fetch the balance for the specified public key
   */


  (0, _createClass2["default"])(Connection, [{
    key: "fetchAccountBalance",
    value: function () {
      var _fetchAccountBalance = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee2(pubKey) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee2$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                _context2.next = 2;
                return this._rpcReq('getDif', [pubKey.toBase58()]);

              case 2:
                unsafeRes = _context2.sent;
                res = FetchBalanceRpcResult(unsafeRes);

                if (!res.error) {
                  _context2.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context2.abrupt("return", res.result);

              case 8:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee2, this);
      }));

      function fetchAccountBalance(_x3) {
        return _fetchAccountBalance.apply(this, arguments);
      }

      return fetchAccountBalance;
    }()
  }, {
    key: "fetchAccountReputation",
    value: function () {
      var _fetchAccountReputation = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee3(pubKey) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee3$(_context3) {
          while (1) {
            switch (_context3.prev = _context3.next) {
              case 0:
                _context3.next = 2;
                return this._rpcReq('getReputation', [pubKey.toBase58()]);

              case 2:
                unsafeRes = _context3.sent;
                res = FetchBalance1RpcResult(unsafeRes);

                if (!res.error) {
                  _context3.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context3.abrupt("return", res.result);

              case 8:
              case "end":
                return _context3.stop();
            }
          }
        }, _callee3, this);
      }));

      function fetchAccountReputation(_x4) {
        return _fetchAccountReputation.apply(this, arguments);
      }

      return fetchAccountReputation;
    }()
    /**
     * Fetch all the account info for the specified public key
     */

  }, {
    key: "fetchAccountDetail",
    value: function () {
      var _fetchAccountDetail = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee4(pubKey) {
        var unsafeRes, res, result;
        return _regenerator["default"].wrap(function _callee4$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _context4.next = 2;
                return this._rpcReq('getAccountInfo', [pubKey.toBase58()]);

              case 2:
                unsafeRes = _context4.sent;
                res = fetchAccountDetailRpcResult(unsafeRes);

                if (!res.error) {
                  _context4.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                result = res.result;
                (0, _assert["default"])(typeof result !== 'undefined');
                return _context4.abrupt("return", {
                  executable: result.executable,
                  owner: new _pubkey.PubKey(result.owner),
                  difs: result.difs,
                  reputations: result.reputations,
                  data: Buffer.from(result.data)
                });

              case 9:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee4, this);
      }));

      function fetchAccountDetail(_x5) {
        return _fetchAccountDetail.apply(this, arguments);
      }

      return fetchAccountDetail;
    }()
    /**
     * Confirm the transaction identified by the specified signature
     */

  }, {
    key: "confmTxn",
    value: function () {
      var _confmTxn = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee5(signature) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee5$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                _context5.next = 2;
                return this._rpcReq('confirmTxn', [signature]);

              case 2:
                unsafeRes = _context5.sent;
                res = ConfmTxnRpcResult(unsafeRes);

                if (!res.error) {
                  _context5.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context5.abrupt("return", res.result);

              case 8:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee5, this);
      }));

      function confmTxn(_x6) {
        return _confmTxn.apply(this, arguments);
      }

      return confmTxn;
    }()
    /**
     * Return the list of nodes that are currently participating in the cluster
     */

  }, {
    key: "fetchClusterNodes",
    value: function () {
      var _fetchClusterNodes = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee6() {
        var unsafeRes, res_015, res;
        return _regenerator["default"].wrap(function _callee6$(_context6) {
          while (1) {
            switch (_context6.prev = _context6.next) {
              case 0:
                _context6.next = 2;
                return this._rpcReq('getClusterNodes', []);

              case 2:
                unsafeRes = _context6.sent;
                _context6.prev = 3;
                res_015 = GetClusterNodes_015(unsafeRes);

                if (!res_015.error) {
                  _context6.next = 8;
                  break;
                }

                console.log('no', res_015.error);
                throw new Error(res_015.error.message);

              case 8:
                return _context6.abrupt("return", res_015.result.map(function (node) {
                  node.pubkey = node.id;
                  node.id = undefined;
                  return node;
                }));

              case 11:
                _context6.prev = 11;
                _context6.t0 = _context6["catch"](3);

              case 13:
                // End Legacy v0.15 response
                res = GetClusterNodes(unsafeRes);

                if (!res.error) {
                  _context6.next = 16;
                  break;
                }

                throw new Error(res.error.message);

              case 16:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context6.abrupt("return", res.result);

              case 18:
              case "end":
                return _context6.stop();
            }
          }
        }, _callee6, this, [[3, 11]]);
      }));

      function fetchClusterNodes() {
        return _fetchClusterNodes.apply(this, arguments);
      }

      return fetchClusterNodes;
    }()
    /**
     * Return the list of nodes that are currently participating in the cluster
     */

  }, {
    key: "getEpochVoteAccounts",
    value: function () {
      var _getEpochVoteAccounts = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee7() {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee7$(_context7) {
          while (1) {
            switch (_context7.prev = _context7.next) {
              case 0:
                _context7.next = 2;
                return this._rpcReq('getEpochVoteAccounts', []);

              case 2:
                unsafeRes = _context7.sent;
                res = GetEpochVoteAccounts(unsafeRes); //const res = unsafeRes;

                if (!res.error) {
                  _context7.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context7.abrupt("return", res.result);

              case 8:
              case "end":
                return _context7.stop();
            }
          }
        }, _callee7, this);
      }));

      function getEpochVoteAccounts() {
        return _getEpochVoteAccounts.apply(this, arguments);
      }

      return getEpochVoteAccounts;
    }()
    /**
     * Fetch the current slot leader of the cluster
     */

  }, {
    key: "fetchRoundLeader",
    value: function () {
      var _fetchRoundLeader = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee8() {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee8$(_context8) {
          while (1) {
            switch (_context8.prev = _context8.next) {
              case 0:
                _context8.next = 2;
                return this._rpcReq('getRoundLeader', []);

              case 2:
                unsafeRes = _context8.sent;
                res = FetchRoundLeader(unsafeRes);

                if (!res.error) {
                  _context8.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context8.abrupt("return", res.result);

              case 8:
              case "end":
                return _context8.stop();
            }
          }
        }, _callee8, this);
      }));

      function fetchRoundLeader() {
        return _fetchRoundLeader.apply(this, arguments);
      }

      return fetchRoundLeader;
    }()
    /**
     * Fetch the current transaction count of the cluster
     */

  }, {
    key: "fetchSignatureState",
    value: function () {
      var _fetchSignatureState = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee9(signature) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee9$(_context9) {
          while (1) {
            switch (_context9.prev = _context9.next) {
              case 0:
                _context9.next = 2;
                return this._rpcReq('getSignatureState', [signature]);

              case 2:
                unsafeRes = _context9.sent;
                res = FetchSignatureStateRpcResult(unsafeRes);

                if (!res.error) {
                  _context9.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context9.abrupt("return", res.result);

              case 8:
              case "end":
                return _context9.stop();
            }
          }
        }, _callee9, this);
      }));

      function fetchSignatureState(_x7) {
        return _fetchSignatureState.apply(this, arguments);
      }

      return fetchSignatureState;
    }()
    /**
     * Fetch the current transaction count of the cluster
     */

  }, {
    key: "fetchTxnAmount",
    value: function () {
      var _fetchTxnAmount = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee10() {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee10$(_context10) {
          while (1) {
            switch (_context10.prev = _context10.next) {
              case 0:
                _context10.next = 2;
                return this._rpcReq('getTxnCnt', []);

              case 2:
                unsafeRes = _context10.sent;
                res = FetchTxnAmountRpcResult(unsafeRes);

                if (!res.error) {
                  _context10.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context10.abrupt("return", Number(res.result));

              case 8:
              case "end":
                return _context10.stop();
            }
          }
        }, _callee10, this);
      }));

      function fetchTxnAmount() {
        return _fetchTxnAmount.apply(this, arguments);
      }

      return fetchTxnAmount;
    }()
    /**
     * Fetch the current total currency supply of the cluster
     */

  }, {
    key: "getTotalSupply",
    value: function () {
      var _getTotalSupply = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee11() {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee11$(_context11) {
          while (1) {
            switch (_context11.prev = _context11.next) {
              case 0:
                _context11.next = 2;
                return this._rpcReq('getTotalSupply', []);

              case 2:
                unsafeRes = _context11.sent;
                res = GetTotalSupplyRpcResult(unsafeRes);

                if (!res.error) {
                  _context11.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context11.abrupt("return", Number(res.result));

              case 8:
              case "end":
                return _context11.stop();
            }
          }
        }, _callee11, this);
      }));

      function getTotalSupply() {
        return _getTotalSupply.apply(this, arguments);
      }

      return getTotalSupply;
    }()
    /**
     * Fetch a recent blockhash from the cluster
     */

  }, {
    key: "fetchRecentBlockhash",
    value: function () {
      var _fetchRecentBlockhash = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee12() {
        var unsafeRes, res_015, _res_015$result, blockhash, feeCalculator, res;

        return _regenerator["default"].wrap(function _callee12$(_context12) {
          while (1) {
            switch (_context12.prev = _context12.next) {
              case 0:
                _context12.next = 2;
                return this._rpcReq('getLatestBlockhash', []);

              case 2:
                unsafeRes = _context12.sent;
                _context12.prev = 3;
                res_015 = GetRecentBlockhash_015(unsafeRes);

                if (!res_015.error) {
                  _context12.next = 7;
                  break;
                }

                throw new Error(res_015.error.message);

              case 7:
                _res_015$result = (0, _slicedToArray2["default"])(res_015.result, 2), blockhash = _res_015$result[0], feeCalculator = _res_015$result[1];
                feeCalculator.targetSignaturesPerSlot = 42;
                feeCalculator.targetDifsPerSignature = feeCalculator.difsPerSignature;
                return _context12.abrupt("return", [blockhash, feeCalculator]);

              case 13:
                _context12.prev = 13;
                _context12.t0 = _context12["catch"](3);

              case 15:
                // End Legacy v0.15 response
                res = FetchRecentBlockhash(unsafeRes);

                if (!res.error) {
                  _context12.next = 18;
                  break;
                }

                throw new Error(res.error.message);

              case 18:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context12.abrupt("return", res.result);

              case 20:
              case "end":
                return _context12.stop();
            }
          }
        }, _callee12, this, [[3, 13]]);
      }));

      function fetchRecentBlockhash() {
        return _fetchRecentBlockhash.apply(this, arguments);
      }

      return fetchRecentBlockhash;
    }()
    /**
     * Request an allocation of difs to the specified account
     */

  }, {
    key: "reqDrone",
    value: function () {
      var _reqDrone = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee13(to, amount) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee13$(_context13) {
          while (1) {
            switch (_context13.prev = _context13.next) {
              case 0:
                _context13.next = 2;
                return this._rpcReq('requestDif', [to.toBase58(), amount]);

              case 2:
                unsafeRes = _context13.sent;
                res = ReqDroneRpcResult(unsafeRes);

                if (!res.error) {
                  _context13.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context13.abrupt("return", res.result);

              case 8:
              case "end":
                return _context13.stop();
            }
          }
        }, _callee13, this);
      }));

      function reqDrone(_x8, _x9) {
        return _reqDrone.apply(this, arguments);
      }

      return reqDrone;
    }()
    /**
    * Request an allocation of reputations to the specified account
    */

  }, {
    key: "reqDrone1",
    value: function () {
      var _reqDrone2 = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee14(to, amount) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee14$(_context14) {
          while (1) {
            switch (_context14.prev = _context14.next) {
              case 0:
                _context14.next = 2;
                return this._rpcReq('requestDif1', [to.toBase58(), amount]);

              case 2:
                unsafeRes = _context14.sent;
                res = ReqDrone1RpcResult(unsafeRes);

                if (!res.error) {
                  _context14.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context14.abrupt("return", res.result);

              case 8:
              case "end":
                return _context14.stop();
            }
          }
        }, _callee14, this);
      }));

      function reqDrone1(_x10, _x11) {
        return _reqDrone2.apply(this, arguments);
      }

      return reqDrone1;
    }()
    /**
     * Sign and send a transaction
     */

  }, {
    key: "sendTxn",
    value: function () {
      var _sendTxn = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee15(transaction) {
        var _len,
            signers,
            _key,
            seconds,
            signature,
            attempts,
            startTime,
            _ref2,
            _ref3,
            recentPackagehash,
            wireTransaction,
            _args15 = arguments;

        return _regenerator["default"].wrap(function _callee15$(_context15) {
          while (1) {
            switch (_context15.prev = _context15.next) {
              case 0:
                for (_len = _args15.length, signers = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
                  signers[_key - 1] = _args15[_key];
                }

              case 1:
                // Attempt to use a recent blockhash for up to 30 seconds
                seconds = new Date().getSeconds();

                if (!(this._blockhashInfo.recentPackagehash != null && this._blockhashInfo.seconds < seconds + 30)) {
                  _context15.next = 12;
                  break;
                }

                transaction.recentPackagehash = this._blockhashInfo.recentPackagehash;
                transaction.sign.apply(transaction, signers);

                if (transaction.signature) {
                  _context15.next = 7;
                  break;
                }

                throw new Error('!signature');

              case 7:
                // If the signature of this transaction has not been seen before with the
                // current recentPackagehash, all done.
                signature = transaction.signature.toString();

                if (this._blockhashInfo.transactionSignatures.includes(signature)) {
                  _context15.next = 12;
                  break;
                }

                this._blockhashInfo.transactionSignatures.push(signature);

                if (this._disableBlockhashCaching) {
                  this._blockhashInfo.seconds = -1;
                }

                return _context15.abrupt("break", 31);

              case 12:
                // Fetch a new blockhash
                attempts = 0;
                startTime = Date.now();

              case 14:
                _context15.next = 16;
                return this.fetchRecentBlockhash();

              case 16:
                _ref2 = _context15.sent;
                _ref3 = (0, _slicedToArray2["default"])(_ref2, 1);
                recentPackagehash = _ref3[0];

                if (!(this._blockhashInfo.recentPackagehash != recentPackagehash)) {
                  _context15.next = 22;
                  break;
                }

                this._blockhashInfo = {
                  recentPackagehash: recentPackagehash,
                  seconds: new Date().getSeconds(),
                  transactionSignatures: []
                };
                return _context15.abrupt("break", 29);

              case 22:
                if (!(attempts === 50)) {
                  _context15.next = 24;
                  break;
                }

                throw new Error("Unable to obtain a new blockhash after ".concat(Date.now() - startTime, "ms"));

              case 24:
                _context15.next = 26;
                return (0, _sleep.sleep)(500 * _timing.DEFAULT_TICKS_PER_SLOT / _timing.NUM_TICKS_PER_SEC);

              case 26:
                ++attempts;

              case 27:
                _context15.next = 14;
                break;

              case 29:
                _context15.next = 1;
                break;

              case 31:
                wireTransaction = transaction.serialize();
                _context15.next = 34;
                return this.sendNativeTxn(wireTransaction);

              case 34:
                return _context15.abrupt("return", _context15.sent);

              case 35:
              case "end":
                return _context15.stop();
            }
          }
        }, _callee15, this);
      }));

      function sendTxn(_x12) {
        return _sendTxn.apply(this, arguments);
      }

      return sendTxn;
    }()
    /**
     * @private
     */

  }, {
    key: "fullnodeExit",
    value: function () {
      var _fullnodeExit = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee16() {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee16$(_context16) {
          while (1) {
            switch (_context16.prev = _context16.next) {
              case 0:
                _context16.next = 2;
                return this._rpcReq('fullnodeQuit', []);

              case 2:
                unsafeRes = _context16.sent;
                res = jsonRpcResult('boolean')(unsafeRes);

                if (!res.error) {
                  _context16.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                return _context16.abrupt("return", res.result);

              case 8:
              case "end":
                return _context16.stop();
            }
          }
        }, _callee16, this);
      }));

      function fullnodeExit() {
        return _fullnodeExit.apply(this, arguments);
      }

      return fullnodeExit;
    }()
    /**
     * Send a transaction that has already been signed and serialized into the
     * wire format
     */

  }, {
    key: "sendNativeTxn",
    value: function () {
      var _sendNativeTxn = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee17(rawTransaction) {
        var unsafeRes, res;
        return _regenerator["default"].wrap(function _callee17$(_context17) {
          while (1) {
            switch (_context17.prev = _context17.next) {
              case 0:
                _context17.next = 2;
                return this._rpcReq('sendTxn', [(0, _toConsumableArray2["default"])(rawTransaction)]);

              case 2:
                unsafeRes = _context17.sent;
                res = SendTxnRpcResult(unsafeRes);

                if (!res.error) {
                  _context17.next = 6;
                  break;
                }

                throw new Error(res.error.message);

              case 6:
                (0, _assert["default"])(typeof res.result !== 'undefined');
                (0, _assert["default"])(res.result);
                return _context17.abrupt("return", res.result);

              case 9:
              case "end":
                return _context17.stop();
            }
          }
        }, _callee17, this);
      }));

      function sendNativeTxn(_x13) {
        return _sendNativeTxn.apply(this, arguments);
      }

      return sendNativeTxn;
    }()
    /**
     * @private
     */

  }, {
    key: "_wsOnOpen",
    value: function _wsOnOpen() {
      this._rpcWebSockConnected = true;

      this._updateSubscriptions();
    }
    /**
     * @private
     */

  }, {
    key: "_wsOnErr",
    value: function _wsOnErr(err) {
      console.log('ws error:', err.message);
    }
    /**
     * @private
     */

  }, {
    key: "_wsOnClose",
    value: function _wsOnClose(code, message) {
      // 1000 means _rpcWebSock.close() was called explicitly
      if (code !== 1000) {
        console.log('ws close:', code, message);
      }

      this._rpcWebSockConnected = false;
    }
    /**
     * @private
     */

  }, {
    key: "_updateSubscriptions",
    value: function () {
      var _updateSubscriptions2 = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee18() {
        var accountKeys, programKeys, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, id, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _id, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, _id2, _this$_accountChangeS, subscriptionId, pubKey, _iteratorNormalCompletion4, _didIteratorError4, _iteratorError4, _iterator4, _step4, _id3, _this$_controllerAcco, controllerId;

        return _regenerator["default"].wrap(function _callee18$(_context18) {
          while (1) {
            switch (_context18.prev = _context18.next) {
              case 0:
                accountKeys = Object.keys(this._accountChangeSubscriptions).map(Number);
                programKeys = Object.keys(this._controllerAccountChangeSubscriptions).map(Number);

                if (!(accountKeys.length === 0 && programKeys.length === 0)) {
                  _context18.next = 5;
                  break;
                }

                this._rpcWebSock.close();

                return _context18.abrupt("return");

              case 5:
                if (this._rpcWebSockConnected) {
                  _context18.next = 46;
                  break;
                }

                _iteratorNormalCompletion = true;
                _didIteratorError = false;
                _iteratorError = undefined;
                _context18.prev = 9;

                for (_iterator = accountKeys[Symbol.iterator](); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                  id = _step.value;
                  this._accountChangeSubscriptions[id].subscriptionId = null;
                }

                _context18.next = 17;
                break;

              case 13:
                _context18.prev = 13;
                _context18.t0 = _context18["catch"](9);
                _didIteratorError = true;
                _iteratorError = _context18.t0;

              case 17:
                _context18.prev = 17;
                _context18.prev = 18;

                if (!_iteratorNormalCompletion && _iterator["return"] != null) {
                  _iterator["return"]();
                }

              case 20:
                _context18.prev = 20;

                if (!_didIteratorError) {
                  _context18.next = 23;
                  break;
                }

                throw _iteratorError;

              case 23:
                return _context18.finish(20);

              case 24:
                return _context18.finish(17);

              case 25:
                _iteratorNormalCompletion2 = true;
                _didIteratorError2 = false;
                _iteratorError2 = undefined;
                _context18.prev = 28;

                for (_iterator2 = programKeys[Symbol.iterator](); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
                  _id = _step2.value;
                  this._controllerAccountChangeSubscriptions[_id].subscriptionId = null;
                }

                _context18.next = 36;
                break;

              case 32:
                _context18.prev = 32;
                _context18.t1 = _context18["catch"](28);
                _didIteratorError2 = true;
                _iteratorError2 = _context18.t1;

              case 36:
                _context18.prev = 36;
                _context18.prev = 37;

                if (!_iteratorNormalCompletion2 && _iterator2["return"] != null) {
                  _iterator2["return"]();
                }

              case 39:
                _context18.prev = 39;

                if (!_didIteratorError2) {
                  _context18.next = 42;
                  break;
                }

                throw _iteratorError2;

              case 42:
                return _context18.finish(39);

              case 43:
                return _context18.finish(36);

              case 44:
                this._rpcWebSock.connect();

                return _context18.abrupt("return");

              case 46:
                _iteratorNormalCompletion3 = true;
                _didIteratorError3 = false;
                _iteratorError3 = undefined;
                _context18.prev = 49;
                _iterator3 = accountKeys[Symbol.iterator]();

              case 51:
                if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {
                  _context18.next = 67;
                  break;
                }

                _id2 = _step3.value;
                _this$_accountChangeS = this._accountChangeSubscriptions[_id2], subscriptionId = _this$_accountChangeS.subscriptionId, pubKey = _this$_accountChangeS.pubKey;

                if (!(subscriptionId === null)) {
                  _context18.next = 64;
                  break;
                }

                _context18.prev = 55;
                _context18.next = 58;
                return this._rpcWebSock.call('accountSubscribe', [pubKey]);

              case 58:
                this._accountChangeSubscriptions[_id2].subscriptionId = _context18.sent;
                _context18.next = 64;
                break;

              case 61:
                _context18.prev = 61;
                _context18.t2 = _context18["catch"](55);
                console.log("accountSubscribe error for ".concat(pubKey, ": ").concat(_context18.t2.message));

              case 64:
                _iteratorNormalCompletion3 = true;
                _context18.next = 51;
                break;

              case 67:
                _context18.next = 73;
                break;

              case 69:
                _context18.prev = 69;
                _context18.t3 = _context18["catch"](49);
                _didIteratorError3 = true;
                _iteratorError3 = _context18.t3;

              case 73:
                _context18.prev = 73;
                _context18.prev = 74;

                if (!_iteratorNormalCompletion3 && _iterator3["return"] != null) {
                  _iterator3["return"]();
                }

              case 76:
                _context18.prev = 76;

                if (!_didIteratorError3) {
                  _context18.next = 79;
                  break;
                }

                throw _iteratorError3;

              case 79:
                return _context18.finish(76);

              case 80:
                return _context18.finish(73);

              case 81:
                _iteratorNormalCompletion4 = true;
                _didIteratorError4 = false;
                _iteratorError4 = undefined;
                _context18.prev = 84;
                _iterator4 = programKeys[Symbol.iterator]();

              case 86:
                if (_iteratorNormalCompletion4 = (_step4 = _iterator4.next()).done) {
                  _context18.next = 102;
                  break;
                }

                _id3 = _step4.value;
                _this$_controllerAcco = this._controllerAccountChangeSubscriptions[_id3], subscriptionId = _this$_controllerAcco.subscriptionId, controllerId = _this$_controllerAcco.controllerId;

                if (!(subscriptionId === null)) {
                  _context18.next = 99;
                  break;
                }

                _context18.prev = 90;
                _context18.next = 93;
                return this._rpcWebSock.call('programSubscribe', [controllerId]);

              case 93:
                this._controllerAccountChangeSubscriptions[_id3].subscriptionId = _context18.sent;
                _context18.next = 99;
                break;

              case 96:
                _context18.prev = 96;
                _context18.t4 = _context18["catch"](90);
                console.log("programSubscribe error for ".concat(controllerId, ": ").concat(_context18.t4.message));

              case 99:
                _iteratorNormalCompletion4 = true;
                _context18.next = 86;
                break;

              case 102:
                _context18.next = 108;
                break;

              case 104:
                _context18.prev = 104;
                _context18.t5 = _context18["catch"](84);
                _didIteratorError4 = true;
                _iteratorError4 = _context18.t5;

              case 108:
                _context18.prev = 108;
                _context18.prev = 109;

                if (!_iteratorNormalCompletion4 && _iterator4["return"] != null) {
                  _iterator4["return"]();
                }

              case 111:
                _context18.prev = 111;

                if (!_didIteratorError4) {
                  _context18.next = 114;
                  break;
                }

                throw _iteratorError4;

              case 114:
                return _context18.finish(111);

              case 115:
                return _context18.finish(108);

              case 116:
              case "end":
                return _context18.stop();
            }
          }
        }, _callee18, this, [[9, 13, 17, 25], [18,, 20, 24], [28, 32, 36, 44], [37,, 39, 43], [49, 69, 73, 81], [55, 61], [74,, 76, 80], [84, 104, 108, 116], [90, 96], [109,, 111, 115]]);
      }));

      function _updateSubscriptions() {
        return _updateSubscriptions2.apply(this, arguments);
      }

      return _updateSubscriptions;
    }()
    /**
     * @private
     */

  }, {
    key: "_wsOnAccountNotice",
    value: function _wsOnAccountNotice(notification) {
      var res = AccountNoticeResult(notification);

      if (res.error) {
        throw new Error(res.error.message);
      }

      var keys = Object.keys(this._accountChangeSubscriptions).map(Number);
      var _iteratorNormalCompletion5 = true;
      var _didIteratorError5 = false;
      var _iteratorError5 = undefined;

      try {
        for (var _iterator5 = keys[Symbol.iterator](), _step5; !(_iteratorNormalCompletion5 = (_step5 = _iterator5.next()).done); _iteratorNormalCompletion5 = true) {
          var id = _step5.value;
          var sub = this._accountChangeSubscriptions[id];

          if (sub.subscriptionId === res.subscription) {
            var result = res.result;
            (0, _assert["default"])(typeof result !== 'undefined');
            sub.callback({
              executable: result.executable,
              owner: new _pubkey.PubKey(result.owner),
              difs: result.difs,
              reputations: result.reputations,
              data: Buffer.from(result.data)
            });
            return true;
          }
        }
      } catch (err) {
        _didIteratorError5 = true;
        _iteratorError5 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion5 && _iterator5["return"] != null) {
            _iterator5["return"]();
          }
        } finally {
          if (_didIteratorError5) {
            throw _iteratorError5;
          }
        }
      }
    }
    /**
     * Register a callback to be invoked whenever the specified account changes
     *
     * @param publickey Public key of the account to monitor
     * @param callback Function to invoke whenever the account is changed
     * @return subscription id
     */

  }, {
    key: "onAccountChange",
    value: function onAccountChange(pubKey, callback) {
      var id = ++this._accountChangeSubscriptionCounter;
      this._accountChangeSubscriptions[id] = {
        pubKey: pubKey.toBase58(),
        callback: callback,
        subscriptionId: null
      };

      this._updateSubscriptions();

      return id;
    }
    /**
     * Deregister an account notification callback
     *
     * @param id subscription id to deregister
     */

  }, {
    key: "removeListenerOfAccountChange",
    value: function () {
      var _removeListenerOfAccountChange = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee19(id) {
        var subscriptionId;
        return _regenerator["default"].wrap(function _callee19$(_context19) {
          while (1) {
            switch (_context19.prev = _context19.next) {
              case 0:
                if (!this._accountChangeSubscriptions[id]) {
                  _context19.next = 15;
                  break;
                }

                subscriptionId = this._accountChangeSubscriptions[id].subscriptionId;
                delete this._accountChangeSubscriptions[id];

                if (!(subscriptionId !== null)) {
                  _context19.next = 12;
                  break;
                }

                _context19.prev = 4;
                _context19.next = 7;
                return this._rpcWebSock.call('accountUnsubscribe', [subscriptionId]);

              case 7:
                _context19.next = 12;
                break;

              case 9:
                _context19.prev = 9;
                _context19.t0 = _context19["catch"](4);
                console.log('accountUnsubscribe error:', _context19.t0.message);

              case 12:
                this._updateSubscriptions();

                _context19.next = 16;
                break;

              case 15:
                throw new Error("Unknown account change id: ".concat(id));

              case 16:
              case "end":
                return _context19.stop();
            }
          }
        }, _callee19, this, [[4, 9]]);
      }));

      function removeListenerOfAccountChange(_x14) {
        return _removeListenerOfAccountChange.apply(this, arguments);
      }

      return removeListenerOfAccountChange;
    }()
    /**
     * @private
     */

  }, {
    key: "_wsOnProgramAccountNotification",
    value: function _wsOnProgramAccountNotification(notification) {
      var res = ControllerAccountNoticeResult(notification);

      if (res.error) {
        throw new Error(res.error.message);
      }

      var keys = Object.keys(this._controllerAccountChangeSubscriptions).map(Number);
      var _iteratorNormalCompletion6 = true;
      var _didIteratorError6 = false;
      var _iteratorError6 = undefined;

      try {
        for (var _iterator6 = keys[Symbol.iterator](), _step6; !(_iteratorNormalCompletion6 = (_step6 = _iterator6.next()).done); _iteratorNormalCompletion6 = true) {
          var id = _step6.value;
          var sub = this._controllerAccountChangeSubscriptions[id];

          if (sub.subscriptionId === res.subscription) {
            var result = res.result;
            (0, _assert["default"])(typeof result !== 'undefined');
            sub.callback({
              accountId: result[0],
              fetchAccountDetail: {
                executable: result[1].executable,
                owner: new _pubkey.PubKey(result[1].owner),
                difs: result[1].difs,
                reputations: result[1].reputations,
                data: Buffer.from(result[1].data)
              }
            });
            return true;
          }
        }
      } catch (err) {
        _didIteratorError6 = true;
        _iteratorError6 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion6 && _iterator6["return"] != null) {
            _iterator6["return"]();
          }
        } finally {
          if (_didIteratorError6) {
            throw _iteratorError6;
          }
        }
      }
    }
    /**
     * Register a callback to be invoked whenever accounts owned by the
     * specified controller change
     *
     * @param controllerId Public key of the controller to monitor
     * @param callback Function to invoke whenever the account is changed
     * @return subscription id
     */

  }, {
    key: "onControllerAccountChange",
    value: function onControllerAccountChange(controllerId, callback) {
      var id = ++this._controllerAccountChangeSubscriptionCounter;
      this._controllerAccountChangeSubscriptions[id] = {
        controllerId: controllerId.toBase58(),
        callback: callback,
        subscriptionId: null
      };

      this._updateSubscriptions();

      return id;
    }
    /**
     * Deregister an account notification callback
     *
     * @param id subscription id to deregister
     */

  }, {
    key: "removeControllerAccountChangeListener",
    value: function () {
      var _removeControllerAccountChangeListener = (0, _asyncToGenerator2["default"])(
      /*#__PURE__*/
      _regenerator["default"].mark(function _callee20(id) {
        var subscriptionId;
        return _regenerator["default"].wrap(function _callee20$(_context20) {
          while (1) {
            switch (_context20.prev = _context20.next) {
              case 0:
                if (!this._controllerAccountChangeSubscriptions[id]) {
                  _context20.next = 15;
                  break;
                }

                subscriptionId = this._controllerAccountChangeSubscriptions[id].subscriptionId;
                delete this._controllerAccountChangeSubscriptions[id];

                if (!(subscriptionId !== null)) {
                  _context20.next = 12;
                  break;
                }

                _context20.prev = 4;
                _context20.next = 7;
                return this._rpcWebSock.call('programUnsubscribe', [subscriptionId]);

              case 7:
                _context20.next = 12;
                break;

              case 9:
                _context20.prev = 9;
                _context20.t0 = _context20["catch"](4);
                console.log('programUnsubscribe error:', _context20.t0.message);

              case 12:
                this._updateSubscriptions();

                _context20.next = 16;
                break;

              case 15:
                throw new Error("Unknown account change id: ".concat(id));

              case 16:
              case "end":
                return _context20.stop();
            }
          }
        }, _callee20, this, [[4, 9]]);
      }));

      function removeControllerAccountChangeListener(_x15) {
        return _removeControllerAccountChangeListener.apply(this, arguments);
      }

      return removeControllerAccountChangeListener;
    }()
  }]);
  return Connection;
}();

exports.Connection = Connection;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbm5lY3Rpb24uanMiXSwibmFtZXMiOlsiY3JlYXRlUnBjUmVxIiwidXJsIiwic2VydmVyIiwicmVxdWVzdCIsImNhbGxiYWNrIiwib3B0aW9ucyIsIm1ldGhvZCIsImJvZHkiLCJoZWFkZXJzIiwicmVzIiwidGV4dCIsImFyZ3MiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImVyciIsInJlc3BvbnNlIiwiRmV0Y2hCYWxhbmNlUnBjUmVzdWx0IiwianNvbnJwYyIsInN0cnVjdCIsImxpdGVyYWwiLCJpZCIsImVycm9yIiwicmVzdWx0IiwiRmV0Y2hSZXB1dGF0aW9uUnBjUmVzdWx0IiwianNvblJwY1Jlc3VsdCIsInJlc3VsdERlc2NyaXB0aW9uIiwianNvblJwY1ZlcnNpb24iLCJ1bmlvbiIsIkFjY291bnREZXRhaWxSZXN1bHQiLCJleGVjdXRhYmxlIiwib3duZXIiLCJkaWZzIiwicmVwdXRhdGlvbnMiLCJkYXRhIiwiZmV0Y2hBY2NvdW50RGV0YWlsUnBjUmVzdWx0IiwiQWNjb3VudE5vdGljZVJlc3VsdCIsInN1YnNjcmlwdGlvbiIsIkNvbnRyb2xsZXJBY2NvdW50RGV0YWlsUmVzdWx0IiwiQ29udHJvbGxlckFjY291bnROb3RpY2VSZXN1bHQiLCJDb25mbVR4blJwY1Jlc3VsdCIsIkZldGNoUm91bmRMZWFkZXIiLCJHZXRDbHVzdGVyTm9kZXMiLCJsaXN0IiwicHVia2V5IiwiZ29zc2lwIiwidHB1IiwicnBjIiwiR2V0Q2x1c3Rlck5vZGVzXzAxNSIsIkdldEVwb2NoVm90ZUFjY291bnRzIiwidm90ZVB1YmtleSIsIm5vZGVQdWJrZXkiLCJzdGFrZSIsImNvbW1pc3Npb24iLCJGZXRjaFNpZ25hdHVyZVN0YXRlUnBjUmVzdWx0IiwiT2siLCJFcnIiLCJGZXRjaFR4bkFtb3VudFJwY1Jlc3VsdCIsIkdldFRvdGFsU3VwcGx5UnBjUmVzdWx0IiwiRmV0Y2hSZWNlbnRCbG9ja2hhc2giLCJkaWZzUGVyU2lnbmF0dXJlIiwibWF4RGlmc1BlclNpZ25hdHVyZSIsIm1pbkRpZnNQZXJTaWduYXR1cmUiLCJ0YXJnZXREaWZzUGVyU2lnbmF0dXJlIiwidGFyZ2V0U2lnbmF0dXJlc1BlclNsb3QiLCJHZXRSZWNlbnRCbG9ja2hhc2hfMDE1IiwiUmVxRHJvbmVScGNSZXN1bHQiLCJSZXFEcm9uZTFScGNSZXN1bHQiLCJTZW5kVHhuUnBjUmVzdWx0IiwiQ29ubmVjdGlvbiIsImVuZHBvaW50IiwiX3JwY1JlcSIsImhyZWYiLCJfYmxvY2toYXNoSW5mbyIsInJlY2VudFBhY2thZ2VoYXNoIiwic2Vjb25kcyIsInRyYW5zYWN0aW9uU2lnbmF0dXJlcyIsInByb3RvY29sIiwiaG9zdCIsInBvcnQiLCJTdHJpbmciLCJOdW1iZXIiLCJfcnBjV2ViU29jayIsIlJwY1dlYlNvY2tldENsaWVudCIsImF1dG9jb25uZWN0IiwibWF4X3JlY29ubmVjdHMiLCJJbmZpbml0eSIsIm9uIiwiX3dzT25PcGVuIiwiYmluZCIsIl93c09uRXJyIiwiX3dzT25DbG9zZSIsIl93c09uQWNjb3VudE5vdGljZSIsIl93c09uUHJvZ3JhbUFjY291bnROb3RpZmljYXRpb24iLCJwdWJLZXkiLCJ0b0Jhc2U1OCIsInVuc2FmZVJlcyIsIkVycm9yIiwibWVzc2FnZSIsIkZldGNoQmFsYW5jZTFScGNSZXN1bHQiLCJQdWJLZXkiLCJCdWZmZXIiLCJmcm9tIiwic2lnbmF0dXJlIiwicmVzXzAxNSIsImNvbnNvbGUiLCJsb2ciLCJtYXAiLCJub2RlIiwidW5kZWZpbmVkIiwiYmxvY2toYXNoIiwiZmVlQ2FsY3VsYXRvciIsInRvIiwiYW1vdW50IiwidHJhbnNhY3Rpb24iLCJzaWduZXJzIiwiRGF0ZSIsImdldFNlY29uZHMiLCJzaWduIiwidG9TdHJpbmciLCJpbmNsdWRlcyIsInB1c2giLCJfZGlzYWJsZUJsb2NraGFzaENhY2hpbmciLCJhdHRlbXB0cyIsInN0YXJ0VGltZSIsIm5vdyIsImZldGNoUmVjZW50QmxvY2toYXNoIiwiREVGQVVMVF9USUNLU19QRVJfU0xPVCIsIk5VTV9USUNLU19QRVJfU0VDIiwid2lyZVRyYW5zYWN0aW9uIiwic2VyaWFsaXplIiwic2VuZE5hdGl2ZVR4biIsInJhd1RyYW5zYWN0aW9uIiwiX3JwY1dlYlNvY2tDb25uZWN0ZWQiLCJfdXBkYXRlU3Vic2NyaXB0aW9ucyIsImNvZGUiLCJhY2NvdW50S2V5cyIsIk9iamVjdCIsImtleXMiLCJfYWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnMiLCJwcm9ncmFtS2V5cyIsIl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnMiLCJsZW5ndGgiLCJjbG9zZSIsInN1YnNjcmlwdGlvbklkIiwiY29ubmVjdCIsImNhbGwiLCJjb250cm9sbGVySWQiLCJub3RpZmljYXRpb24iLCJzdWIiLCJfYWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbkNvdW50ZXIiLCJhY2NvdW50SWQiLCJmZXRjaEFjY291bnREZXRhaWwiLCJfY29udHJvbGxlckFjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25Db3VudGVyIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQUNBOztBQUNBOztBQUNBOztBQXdDQSxTQUFTQSxZQUFULENBQXNCQyxHQUF0QixFQUFtQztBQUNqQyxNQUFNQyxNQUFNLEdBQUc7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGlDQUFPLGlCQUFPQyxPQUFQLEVBQWdCQyxRQUFoQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDZEMsY0FBQUEsT0FEYyxHQUNKO0FBQ2RDLGdCQUFBQSxNQUFNLEVBQUUsTUFETTtBQUVkQyxnQkFBQUEsSUFBSSxFQUFFSixPQUZRO0FBR2RLLGdCQUFBQSxPQUFPLEVBQUU7QUFDUCxrQ0FBZ0I7QUFEVDtBQUhLLGVBREk7QUFBQTtBQUFBO0FBQUEscUJBVUEsMkJBQU1QLEdBQU4sRUFBV0ksT0FBWCxDQVZBOztBQUFBO0FBVVpJLGNBQUFBLEdBVlk7QUFBQTtBQUFBLHFCQVdDQSxH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VyxJQUF0QjtBQUxZO0FBRlQsYUFBYjtBQVVBLG1CQUFPLElBQVA7QUFDRDtBQUNGO0FBM0JtRDtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBNEJyRDtBQUVEOzs7Ozs7Ozs7Ozs4Q0FTRWlILFksRUFDQS9JLFEsRUFDUTtBQUNSLFVBQU1pQixFQUFFLEdBQUcsRUFBRSxLQUFLb0ksMkNBQWxCO0FBQ0EsV0FBS1oscUNBQUwsQ0FBMkN4SCxFQUEzQyxJQUFpRDtBQUMvQzhILFFBQUFBLFlBQVksRUFBRUEsWUFBWSxDQUFDcEQsUUFBYixFQURpQztBQUUvQzNGLFFBQUFBLFFBQVEsRUFBUkEsUUFGK0M7QUFHL0M0SSxRQUFBQSxjQUFjLEVBQUU7QUFIK0IsT0FBakQ7O0FBS0EsV0FBS1Ysb0JBQUw7O0FBQ0EsYUFBT2pILEVBQVA7QUFDRDtBQUVEOzs7Ozs7Ozs7OztzREFLNENBLEU7Ozs7OztxQkFDdEMsS0FBS3dILHFDQUFMLENBQTJDeEgsRUFBM0MsQzs7Ozs7QUFDSzJILGdCQUFBQSxjLEdBQWtCLEtBQUtILHFDQUFMLENBQTJDeEgsRUFBM0MsQyxDQUFsQjJILGM7QUFDUCx1QkFBTyxLQUFLSCxxQ0FBTCxDQUEyQ3hILEVBQTNDLENBQVA7O3NCQUNJMkgsY0FBYyxLQUFLLEk7Ozs7Ozs7dUJBRWIsS0FBSzlELFdBQUwsQ0FBaUJnRSxJQUFqQixDQUFzQixvQkFBdEIsRUFBNEMsQ0FBQ0YsY0FBRCxDQUE1QyxDOzs7Ozs7Ozs7QUFFTnZDLGdCQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSwyQkFBWixFQUF5QyxjQUFJUixPQUE3Qzs7O0FBR0oscUJBQUtvQyxvQkFBTDs7Ozs7O3NCQUVNLElBQUlyQyxLQUFKLHNDQUF3QzVFLEVBQXhDLEUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBAZmxvd1xuXG5pbXBvcnQgYXNzZXJ0IGZyb20gJ2Fzc2VydCc7XG5pbXBvcnQge3BhcnNlIGFzIHVybFBhcnNlLCBmb3JtYXQgYXMgdXJsRm9ybWF0fSBmcm9tICd1cmwnO1xuaW1wb3J0IGZldGNoIGZyb20gJ25vZGUtZmV0Y2gnO1xuaW1wb3J0IGpheXNvbiBmcm9tICdqYXlzb24vbGliL2NsaWVudC9icm93c2VyJztcbmltcG9ydCB7c3RydWN0fSBmcm9tICdzdXBlcnN0cnVjdCc7XG5pbXBvcnQge0NsaWVudCBhcyBScGNXZWJTb2NrZXRDbGllbnR9IGZyb20gJ3JwYy13ZWJzb2NrZXRzJztcblxuaW1wb3J0IHtERUZBVUxUX1RJQ0tTX1BFUl9TTE9ULCBOVU1fVElDS1NfUEVSX1NFQ30gZnJvbSAnLi90aW1pbmcnO1xuaW1wb3J0IHtQdWJLZXl9IGZyb20gJy4vcHVia2V5JztcbmltcG9ydCB7VHJhbnNhY3Rpb259IGZyb20gJy4vdHJhbnNhY3Rpb24tY29udHJvbGxlcic7XG5pbXBvcnQge3NsZWVwfSBmcm9tICcuL3V0aWwvc2xlZXAnO1xuaW1wb3J0IHR5cGUge0Jsb2NraGFzaH0gZnJvbSAnLi9idXMtYmxvY2toYXNoJztcbmltcG9ydCB0eXBlIHtGZWVDYWxjdWxhdG9yfSBmcm9tICcuL2ZlZS1jYWxjdWxhdG9yJztcbmltcG9ydCB0eXBlIHtCdXNBY2NvdW50fSBmcm9tICcuL2J1cy1hY2NvdW50JztcbmltcG9ydCB0eXBlIHtUeG5TaWduYXR1cmV9IGZyb20gJy4vdHJhbnNhY3Rpb24tY29udHJvbGxlcic7XG5cbnR5cGUgUnBjUmVxID0gKG1ldGhvZE5hbWU6IHN0cmluZywgYXJnczogQXJyYXk8YW55PikgPT4gYW55O1xuXG4vKipcbiAqIEluZm9ybWF0aW9uIGRlc2NyaWJpbmcgYSBjbHVzdGVyIG5vZGVcbiAqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBOb2RlSW5mb1xuICogQHByb3BlcnR5IHtzdHJpbmd9IHB1YmtleSBJZGVudGl0eSBwdWJsaWMga2V5IG9mIHRoZSBub2RlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gZ29zc2lwIEdvc3NpcCBuZXR3b3JrIGFkZHJlc3MgZm9yIHRoZSBub2RlXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdHB1IFRQVSBuZXR3b3JrIGFkZHJlc3MgZm9yIHRoZSBub2RlIChudWxsIGlmIG5vdCBhdmFpbGFibGUpXG4gKiBAcHJvcGVydHkge3N0cmluZ3xudWxsfSBycGMgSlNPTiBSUEMgbmV0d29yayBhZGRyZXNzIGZvciB0aGUgbm9kZSAobnVsbCBpZiBub3QgYXZhaWxhYmxlKVxuICovXG50eXBlIE5vZGVJbmZvID0ge1xuICBwdWJrZXk6IHN0cmluZyxcbiAgZ29zc2lwOiBzdHJpbmcsXG4gIHRwdTogc3RyaW5nIHwgbnVsbCxcbiAgcnBjOiBzdHJpbmcgfCBudWxsLFxufTtcblxuLyoqXG4gKiBJbmZvcm1hdGlvbiBkZXNjcmliaW5nIGEgdm90ZSBhY2NvdW50XG4gKlxuICogQHR5cGVkZWYge09iamVjdH0gVm90ZUFjY291bnRJbmZvXG4gKiBAcHJvcGVydHkge3N0cmluZ30gdm90ZVB1YmtleSBQdWJsaWMga2V5IG9mIHRoZSB2b3RlIGFjY291bnRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBub2RlUHVia2V5IElkZW50aXR5IHB1YmxpYyBrZXkgb2YgdGhlIG5vZGUgdm90aW5nIHdpdGggdGhpcyBhY2NvdW50XG4gKiBAcHJvcGVydHkge3N0cmluZ30gc3Rha2UgVGhlIHN0YWtlLCBpbiBkaWZzLCBkZWxlZ2F0ZWQgdG8gdGhpcyB2b3RlIGFjY291bnRcbiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBjb21taXNzaW9uIEEgMzItYml0IGludGVnZXIgdXNlZCBhcyBhIGZyYWN0aW9uIChjb21taXNzaW9uLzB4RkZGRkZGRkYpIGZvciByZXdhcmRzIHBheW91dFxuICovXG50eXBlIFZvdGVBY2NvdW50SW5mbyA9IHtcbiAgdm90ZVB1YmtleTogc3RyaW5nLFxuICBub2RlUHVia2V5OiBzdHJpbmcsXG4gIHN0YWtlOiBudW1iZXIsXG4gIGNvbW1pc3Npb246IG51bWJlcixcbn07XG5cbmZ1bmN0aW9uIGNyZWF0ZVJwY1JlcSh1cmwpOiBScGNSZXEge1xuICBjb25zdCBzZXJ2ZXIgPSBqYXlzb24oYXN5bmMgKHJlcXVlc3QsIGNhbGxiYWNrKSA9PiB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgYm9keTogcmVxdWVzdCxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCh1cmwsIG9wdGlvbnMpO1xuICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7XG4gICAgICBjYWxsYmFjayhudWxsLCB0ZXh0KTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIGNhbGxiYWNrKGVycik7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gKG1ldGhvZCwgYXJncykgPT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBzZXJ2ZXIucmVxdWVzdChtZXRob2QsIGFyZ3MsIChlcnIsIHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZShyZXNwb25zZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfTtcbn1cblxuLyoqXG4gKiBFeHBlY3RlZCBKU09OIFJQQyByZXNwb25zZSBmb3IgdGhlIFwiZmV0Y2hBY2NvdW50QmFsYW5jZVwiIG1lc3NhZ2VcbiAqL1xuY29uc3QgRmV0Y2hCYWxhbmNlUnBjUmVzdWx0ID0gc3RydWN0KHtcbiAganNvbnJwYzogc3RydWN0LmxpdGVyYWwoJzIuMCcpLFxuICBpZDogJ3N0cmluZycsXG4gIGVycm9yOiAnYW55PycsXG4gIHJlc3VsdDogJ251bWJlcj8nLFxufSk7XG5cbmNvbnN0IEZldGNoUmVwdXRhdGlvblJwY1Jlc3VsdCA9IHN0cnVjdCh7XG4gIGpzb25ycGM6IHN0cnVjdC5saXRlcmFsKCcyLjAnKSxcbiAgaWQ6ICdzdHJpbmcnLFxuICBlcnJvcjogJ2FueT8nLFxuICByZXN1bHQ6ICdudW1iZXI/Jyxcbn0pO1xuXG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuZnVuY3Rpb24ganNvblJwY1Jlc3VsdChyZXN1bHREZXNjcmlwdGlvbjogYW55KSB7XG4gIGNvbnN0IGpzb25ScGNWZXJzaW9uID0gc3RydWN0LmxpdGVyYWwoJzIuMCcpO1xuICByZXR1cm4gc3RydWN0LnVuaW9uKFtcbiAgICBzdHJ1Y3Qoe1xuICAgICAganNvbnJwYzoganNvblJwY1ZlcnNpb24sXG4gICAgICBpZDogJ3N0cmluZycsXG4gICAgICBlcnJvcjogJ2FueScsXG4gICAgfSksXG4gICAgc3RydWN0KHtcbiAgICAgIGpzb25ycGM6IGpzb25ScGNWZXJzaW9uLFxuICAgICAgaWQ6ICdzdHJpbmcnLFxuICAgICAgZXJyb3I6ICdudWxsPycsXG4gICAgICByZXN1bHQ6IHJlc3VsdERlc2NyaXB0aW9uLFxuICAgIH0pLFxuICBdKTtcbn1cblxuLyoqXG4gKiBAcHJpdmF0ZVxuICovXG5jb25zdCBBY2NvdW50RGV0YWlsUmVzdWx0ID0gc3RydWN0KHtcbiAgZXhlY3V0YWJsZTogJ2Jvb2xlYW4nLFxuICBvd25lcjogJ2FycmF5JyxcbiAgZGlmczogJ251bWJlcicsXG4gIHJlcHV0YXRpb25zOiAnbnVtYmVyJyxcbiAgZGF0YTogJ2FycmF5Jyxcbn0pO1xuXG4vKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJmZXRjaEFjY291bnREZXRhaWxcIiBtZXNzYWdlXG4gKi9cbmNvbnN0IGZldGNoQWNjb3VudERldGFpbFJwY1Jlc3VsdCA9IGpzb25ScGNSZXN1bHQoQWNjb3VudERldGFpbFJlc3VsdCk7XG5cbi8qKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJhY2NvdW50Tm90aWZpY2F0aW9uXCIgbWVzc2FnZVxuICovXG5jb25zdCBBY2NvdW50Tm90aWNlUmVzdWx0ID0gc3RydWN0KHtcbiAgc3Vic2NyaXB0aW9uOiAnbnVtYmVyJyxcbiAgcmVzdWx0OiBBY2NvdW50RGV0YWlsUmVzdWx0LFxufSk7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xuY29uc3QgQ29udHJvbGxlckFjY291bnREZXRhaWxSZXN1bHQgPSBzdHJ1Y3QoWydzdHJpbmcnLCBBY2NvdW50RGV0YWlsUmVzdWx0XSk7XG5cbi8qKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJjb250cm9sbGVyTm90aWZpY2F0aW9uXCIgbWVzc2FnZVxuICovXG5jb25zdCBDb250cm9sbGVyQWNjb3VudE5vdGljZVJlc3VsdCA9IHN0cnVjdCh7XG4gIHN1YnNjcmlwdGlvbjogJ251bWJlcicsXG4gIHJlc3VsdDogQ29udHJvbGxlckFjY291bnREZXRhaWxSZXN1bHQsXG59KTtcblxuLyoqXG4gKiBFeHBlY3RlZCBKU09OIFJQQyByZXNwb25zZSBmb3IgdGhlIFwiY29uZm1UeG5cIiBtZXNzYWdlXG4gKi9cbmNvbnN0IENvbmZtVHhuUnBjUmVzdWx0ID0ganNvblJwY1Jlc3VsdCgnYm9vbGVhbicpO1xuXG4vKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJmZXRjaFJvdW5kTGVhZGVyXCIgbWVzc2FnZVxuICovXG5jb25zdCBGZXRjaFJvdW5kTGVhZGVyID0ganNvblJwY1Jlc3VsdCgnc3RyaW5nJyk7XG5cbi8qKlxuICogRXhwZWN0ZWQgSlNPTiBSUEMgcmVzcG9uc2UgZm9yIHRoZSBcImZldGNoQ2x1c3Rlck5vZGVzXCIgbWVzc2FnZVxuICovXG5jb25zdCBHZXRDbHVzdGVyTm9kZXMgPSBqc29uUnBjUmVzdWx0KFxuICBzdHJ1Y3QubGlzdChbXG4gICAgc3RydWN0KHtcbiAgICAgIHB1YmtleTogJ3N0cmluZycsXG4gICAgICBnb3NzaXA6ICdzdHJpbmcnLFxuICAgICAgdHB1OiBzdHJ1Y3QudW5pb24oWydudWxsJywgJ3N0cmluZyddKSxcbiAgICAgIHJwYzogc3RydWN0LnVuaW9uKFsnbnVsbCcsICdzdHJpbmcnXSksXG4gICAgfSksXG4gIF0pLFxuKTtcbi8qKlxuICogQGlnbm9yZVxuICovXG5jb25zdCBHZXRDbHVzdGVyTm9kZXNfMDE1ID0ganNvblJwY1Jlc3VsdChcbiAgc3RydWN0Lmxpc3QoW1xuICAgIHN0cnVjdCh7XG4gICAgICBpZDogJ3N0cmluZycsXG4gICAgICBnb3NzaXA6ICdzdHJpbmcnLFxuICAgICAgdHB1OiBzdHJ1Y3QudW5pb24oWydudWxsJywgJ3N0cmluZyddKSxcbiAgICAgIHJwYzogc3RydWN0LnVuaW9uKFsnbnVsbCcsICdzdHJpbmcnXSksXG4gICAgfSksXG4gIF0pLFxuKTtcblxuLyoqXG4gKiBFeHBlY3RlZCBKU09OIFJQQyByZXNwb25zZSBmb3IgdGhlIFwiZ2V0RXBvY2hWb3RlQWNjb3VudHNcIiBtZXNzYWdlXG4gKi9cbmNvbnN0IEdldEVwb2NoVm90ZUFjY291bnRzID0ganNvblJwY1Jlc3VsdChcbiAgc3RydWN0Lmxpc3QoW1xuICAgIHN0cnVjdCh7XG4gICAgICB2b3RlUHVia2V5OiAnc3RyaW5nJyxcbiAgICAgIG5vZGVQdWJrZXk6ICdzdHJpbmcnLFxuICAgICAgc3Rha2U6ICdudW1iZXInLFxuICAgICAgY29tbWlzc2lvbjogJ251bWJlcicsXG4gICAgfSksXG4gIF0pLFxuKTtcblxuLyoqXG4gKiBFeHBlY3RlZCBKU09OIFJQQyByZXNwb25zZSBmb3IgdGhlIFwiZmV0Y2hTaWduYXR1cmVTdGF0ZVwiIG1lc3NhZ2VcbiAqL1xuY29uc3QgRmV0Y2hTaWduYXR1cmVTdGF0ZVJwY1Jlc3VsdCA9IGpzb25ScGNSZXN1bHQoXG4gIHN0cnVjdC51bmlvbihbXG4gICAgJ251bGwnLFxuICAgIHN0cnVjdC51bmlvbihbc3RydWN0KHtPazogJ251bGwnfSksIHN0cnVjdCh7RXJyOiAnb2JqZWN0J30pXSksXG4gIF0pLFxuKTtcblxuLyoqXG4gKiBFeHBlY3RlZCBKU09OIFJQQyByZXNwb25zZSBmb3IgdGhlIFwiZmV0Y2hUeG5BbW91bnRcIiBtZXNzYWdlXG4gKi9cbmNvbnN0IEZldGNoVHhuQW1vdW50UnBjUmVzdWx0ID0ganNvblJwY1Jlc3VsdCgnbnVtYmVyJyk7XG5cbi8qKlxuICogRXhwZWN0ZWQgSlNPTiBSUEMgcmVzcG9uc2UgZm9yIHRoZSBcImdldFRvdGFsU3VwcGx5XCIgbWVzc2FnZVxuICovXG5jb25zdCBHZXRUb3RhbFN1cHBseVJwY1Jlc3VsdCA9IGpzb25ScGNSZXN1bHQoJ251bWJlcicpO1xuXG4vKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJmZXRjaFJlY2VudEJsb2NraGFzaFwiIG1lc3NhZ2VcbiAqL1xuY29uc3QgRmV0Y2hSZWNlbnRCbG9ja2hhc2ggPSBqc29uUnBjUmVzdWx0KFtcbiAgJ3N0cmluZycsXG4gIHN0cnVjdCh7XG4gICAgZGlmc1BlclNpZ25hdHVyZTogJ251bWJlcicsXG4gICAgbWF4RGlmc1BlclNpZ25hdHVyZTogJ251bWJlcicsXG4gICAgbWluRGlmc1BlclNpZ25hdHVyZTogJ251bWJlcicsXG4gICAgdGFyZ2V0RGlmc1BlclNpZ25hdHVyZTogJ251bWJlcicsXG4gICAgdGFyZ2V0U2lnbmF0dXJlc1BlclNsb3Q6ICdudW1iZXInLFxuICB9KSxcbl0pO1xuLyoqXG4gKiBAaWdub3JlXG4gKi9cbmNvbnN0IEdldFJlY2VudEJsb2NraGFzaF8wMTUgPSBqc29uUnBjUmVzdWx0KFtcbiAgJ3N0cmluZycsXG4gIHN0cnVjdCh7XG4gICAgZGlmc1BlclNpZ25hdHVyZTogJ251bWJlcicsXG4gIH0pLFxuXSk7XG5cbi8qKlxuICogRXhwZWN0ZWQgSlNPTiBSUEMgcmVzcG9uc2UgZm9yIHRoZSBcInJlcURyb25lXCIgbWVzc2FnZVxuICovXG5jb25zdCBSZXFEcm9uZVJwY1Jlc3VsdCA9IGpzb25ScGNSZXN1bHQoJ3N0cmluZycpO1xuXG4vKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJyZXFEcm9uZTFcIiBtZXNzYWdlXG4gKi9cbmNvbnN0IFJlcURyb25lMVJwY1Jlc3VsdCA9IGpzb25ScGNSZXN1bHQoJ3N0cmluZycpO1xuXG4vKipcbiAqIEV4cGVjdGVkIEpTT04gUlBDIHJlc3BvbnNlIGZvciB0aGUgXCJzZW5kVHhuXCIgbWVzc2FnZVxuICovXG5jb25zdCBTZW5kVHhuUnBjUmVzdWx0ID0ganNvblJwY1Jlc3VsdCgnc3RyaW5nJyk7XG5cbi8qKlxuICogSW5mb3JtYXRpb24gZGVzY3JpYmluZyBhbiBhY2NvdW50XG4gKlxuICogQHR5cGVkZWYge09iamVjdH0gQWNjb3VudERldGFpbFxuICogQHByb3BlcnR5IHtudW1iZXJ9IGRpZnMgTnVtYmVyIG9mIGRpZnMgYXNzaWduZWQgdG8gdGhlIGFjY291bnRcbiAqIEBwcm9wZXJ0eSB7UHViS2V5fSBvd25lciBJZGVudGlmaWVyIG9mIHRoZSBjb250cm9sbGVyIHRoYXQgb3ducyB0aGUgYWNjb3VudFxuICogQHByb3BlcnR5IHs/QnVmZmVyfSBkYXRhIE9wdGlvbmFsIGRhdGEgYXNzaWduZWQgdG8gdGhlIGFjY291bnRcbiAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gZXhlY3V0YWJsZSBgdHJ1ZWAgaWYgdGhpcyBhY2NvdW50J3MgZGF0YSBjb250YWlucyBhIGxvYWRlZCBjb250cm9sbGVyXG4gKi9cbnR5cGUgQWNjb3VudERldGFpbCA9IHtcbiAgZXhlY3V0YWJsZTogYm9vbGVhbixcbiAgb3duZXI6IFB1YktleSxcbiAgZGlmczogbnVtYmVyLFxuICByZXB1dGF0aW9uczogbnVtYmVyLFxuICBkYXRhOiBCdWZmZXIsXG59O1xuXG4vKipcbiAqIEJ1c0FjY291bnQgaW5mb3JtYXRpb24gaWRlbnRpZmllZCBieSBwdWJrZXlcbiAqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBLZXllZEFjY291bnREZXRhaWxcbiAqIEBwcm9wZXJ0eSB7UHViS2V5fSBhY2NvdW50SWRcbiAqIEBwcm9wZXJ0eSB7QWNjb3VudERldGFpbH0gZmV0Y2hBY2NvdW50RGV0YWlsXG4gKi9cbnR5cGUgS2V5ZWRBY2NvdW50RGV0YWlsID0ge1xuICBhY2NvdW50SWQ6IFB1YktleSxcbiAgZmV0Y2hBY2NvdW50RGV0YWlsOiBBY2NvdW50RGV0YWlsLFxufTtcblxuLyoqXG4gKiBDYWxsYmFjayBmdW5jdGlvbiBmb3IgYWNjb3VudCBjaGFuZ2Ugbm90aWZpY2F0aW9uc1xuICovXG5leHBvcnQgdHlwZSBBY2NvdW50Q2hhbmdlQ2FsbGJhY2sgPSAoZmV0Y2hBY2NvdW50RGV0YWlsOiBBY2NvdW50RGV0YWlsKSA9PiB2b2lkO1xuXG4vKipcbiAqIEBwcml2YXRlXG4gKi9cbnR5cGUgQWNjb3VudFN1YnNjcmlwdGlvbkRldGFpbCA9IHtcbiAgcHViS2V5OiBzdHJpbmcsIC8vIFB1YktleSBvZiB0aGUgYWNjb3VudCBhcyBhIGJhc2UgNTggc3RyaW5nXG4gIGNhbGxiYWNrOiBBY2NvdW50Q2hhbmdlQ2FsbGJhY2ssXG4gIHN1YnNjcmlwdGlvbklkOiBudWxsIHwgbnVtYmVyLCAvLyBudWxsIHdoZW4gdGhlcmUncyBubyBjdXJyZW50IHNlcnZlciBzdWJzY3JpcHRpb24gaWRcbn07XG5cbi8qKlxuICogQ2FsbGJhY2sgZnVuY3Rpb24gZm9yIGNvbnRyb2xsZXIgYWNjb3VudCBjaGFuZ2Ugbm90aWZpY2F0aW9uc1xuICovXG5leHBvcnQgdHlwZSBDb250cm9sbGVyQWNjb3VudENoYW5nZUNhbGxiYWNrID0gKFxuICBrZXllZEFjY291bnRJbmZvOiBLZXllZEFjY291bnREZXRhaWwsXG4pID0+IHZvaWQ7XG5cbi8qKlxuICogQHByaXZhdGVcbiAqL1xudHlwZSBDb250cm9sbGVyQWNjb3VudFN1YnNjcmlwdGlvbkRldGFpbCA9IHtcbiAgY29udHJvbGxlcklkOiBzdHJpbmcsIC8vIFB1YktleSBvZiB0aGUgY29udHJvbGxlciBhcyBhIGJhc2UgNTggc3RyaW5nXG4gIGNhbGxiYWNrOiBDb250cm9sbGVyQWNjb3VudENoYW5nZUNhbGxiYWNrLFxuICBzdWJzY3JpcHRpb25JZDogbnVsbCB8IG51bWJlciwgLy8gbnVsbCB3aGVuIHRoZXJlJ3Mgbm8gY3VycmVudCBzZXJ2ZXIgc3Vic2NyaXB0aW9uIGlkXG59O1xuXG4vKipcbiAqIFNpZ25hdHVyZSBzdGF0dXM6IFN1Y2Nlc3NcbiAqXG4gKiBAdHlwZWRlZiB7T2JqZWN0fSBTaWduYXR1cmVQYXNzXG4gKi9cbmV4cG9ydCB0eXBlIFNpZ25hdHVyZVBhc3MgPSB7fFxuICBPazogbnVsbCxcbnx9O1xuXG4vKipcbiAqIFNpZ25hdHVyZSBzdGF0dXM6IFR4bkVyclxuICpcbiAqIEB0eXBlZGVmIHtPYmplY3R9IFR4bkVyclxuICovXG5leHBvcnQgdHlwZSBUeG5FcnIgPSB7fFxuICBFcnI6IE9iamVjdCxcbnx9O1xuXG4vKipcbiAqIEBpZ25vcmVcbiAqL1xudHlwZSBCbG9ja2hhc2hBbmRGZWVDYWxjdWxhdG9yID0gW0Jsb2NraGFzaCwgRmVlQ2FsY3VsYXRvcl07IC8vIFRoaXMgdHlwZSBleGlzdHMgdG8gd29ya2Fyb3VuZCBhbiBlc2RvYyBwYXJzZSBlcnJvclxuXG4vKipcbiAqIEEgY29ubmVjdGlvbiB0byBhIGZ1bGxub2RlIEpTT04gUlBDIGVuZHBvaW50XG4gKi9cbmV4cG9ydCBjbGFzcyBDb25uZWN0aW9uIHtcbiAgX3JwY1JlcTogUnBjUmVxO1xuICBfcnBjV2ViU29jazogUnBjV2ViU29ja2V0Q2xpZW50O1xuICBfcnBjV2ViU29ja0Nvbm5lY3RlZDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIF9ibG9ja2hhc2hJbmZvOiB7XG4gICAgcmVjZW50UGFja2FnZWhhc2g6IEJsb2NraGFzaCB8IG51bGwsXG4gICAgc2Vjb25kczogbnVtYmVyLFxuICAgIHRyYW5zYWN0aW9uU2lnbmF0dXJlczogQXJyYXk8c3RyaW5nPixcbiAgfTtcbiAgX2Rpc2FibGVCbG9ja2hhc2hDYWNoaW5nOiBib29sZWFuID0gZmFsc2U7XG4gIF9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uczoge1tudW1iZXJdOiBBY2NvdW50U3Vic2NyaXB0aW9uRGV0YWlsfSA9IHt9O1xuICBfYWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbkNvdW50ZXI6IG51bWJlciA9IDA7XG4gIF9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnM6IHtcbiAgICBbbnVtYmVyXTogQ29udHJvbGxlckFjY291bnRTdWJzY3JpcHRpb25EZXRhaWwsXG4gIH0gPSB7fTtcbiAgX2NvbnRyb2xsZXJBY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uQ291bnRlcjogbnVtYmVyID0gMDtcblxuICAvKipcbiAgICogRXN0YWJsaXNoIGEgSlNPTiBSUEMgY29ubmVjdGlvblxuICAgKlxuICAgKiBAcGFyYW0gZW5kcG9pbnQgVVJMIHRvIHRoZSBmdWxsbm9kZSBKU09OIFJQQyBlbmRwb2ludFxuICAgKi9cbiAgY29uc3RydWN0b3IoZW5kcG9pbnQ6IHN0cmluZykge1xuICAgIGxldCB1cmwgPSB1cmxQYXJzZShlbmRwb2ludCk7XG5cbiAgICB0aGlzLl9ycGNSZXEgPSBjcmVhdGVScGNSZXEodXJsLmhyZWYpO1xuICAgIHRoaXMuX2Jsb2NraGFzaEluZm8gPSB7XG4gICAgICByZWNlbnRQYWNrYWdlaGFzaDogbnVsbCxcbiAgICAgIHNlY29uZHM6IC0xLFxuICAgICAgdHJhbnNhY3Rpb25TaWduYXR1cmVzOiBbXSxcbiAgICB9O1xuXG4gICAgdXJsLnByb3RvY29sID0gdXJsLnByb3RvY29sID09PSAnaHR0cHM6JyA/ICd3c3M6JyA6ICd3czonO1xuICAgIHVybC5ob3N0ID0gJyc7XG4gICAgdXJsLnBvcnQgPSBTdHJpbmcoTnVtYmVyKHVybC5wb3J0KSArIDEpO1xuICAgIGlmICh1cmwucG9ydCA9PT0gJzEnKSB7XG4gICAgICB1cmwucG9ydCA9IHVybC5wcm90b2NvbCA9PT0gJ3dzczonID8gJzg5MDEnIDogJzg5MDAnO1xuICAgIH1cbiAgICB0aGlzLl9ycGNXZWJTb2NrID0gbmV3IFJwY1dlYlNvY2tldENsaWVudCh1cmxGb3JtYXQodXJsKSwge1xuICAgICAgYXV0b2Nvbm5lY3Q6IGZhbHNlLFxuICAgICAgbWF4X3JlY29ubmVjdHM6IEluZmluaXR5LFxuICAgIH0pO1xuICAgIHRoaXMuX3JwY1dlYlNvY2sub24oJ29wZW4nLCB0aGlzLl93c09uT3Blbi5iaW5kKHRoaXMpKTtcbiAgICB0aGlzLl9ycGNXZWJTb2NrLm9uKCdlcnJvcicsIHRoaXMuX3dzT25FcnIuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5fcnBjV2ViU29jay5vbignY2xvc2UnLCB0aGlzLl93c09uQ2xvc2UuYmluZCh0aGlzKSk7XG4gICAgdGhpcy5fcnBjV2ViU29jay5vbihcbiAgICAgICdhY2NvdW50Tm90aWZpY2F0aW9uJyxcbiAgICAgIHRoaXMuX3dzT25BY2NvdW50Tm90aWNlLmJpbmQodGhpcyksXG4gICAgKTtcbiAgICB0aGlzLl9ycGNXZWJTb2NrLm9uKFxuICAgICAgJ2NvbnRyb2xsZXJOb3RpZmljYXRpb24nLFxuICAgICAgdGhpcy5fd3NPblByb2dyYW1BY2NvdW50Tm90aWZpY2F0aW9uLmJpbmQodGhpcyksXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCB0aGUgYmFsYW5jZSBmb3IgdGhlIHNwZWNpZmllZCBwdWJsaWMga2V5XG4gICAqL1xuICBhc3luYyBmZXRjaEFjY291bnRCYWxhbmNlKHB1YktleTogUHViS2V5KTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCB1bnNhZmVSZXMgPSBhd2FpdCB0aGlzLl9ycGNSZXEoJ2dldERpZicsIFtcbiAgICAgIHB1YktleS50b0Jhc2U1OCgpLFxuICAgIF0pO1xuICAgIGNvbnN0IHJlcyA9IEZldGNoQmFsYW5jZVJwY1Jlc3VsdCh1bnNhZmVSZXMpO1xuICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgcmVzLnJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgIHJldHVybiByZXMucmVzdWx0O1xuICB9XG5cbiAgYXN5bmMgZmV0Y2hBY2NvdW50UmVwdXRhdGlvbihwdWJLZXk6IFB1YktleSk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgdW5zYWZlUmVzID0gYXdhaXQgdGhpcy5fcnBjUmVxKCdnZXRSZXB1dGF0aW9uJywgW1xuICAgICAgcHViS2V5LnRvQmFzZTU4KCksXG4gICAgXSk7XG4gICAgY29uc3QgcmVzID0gRmV0Y2hCYWxhbmNlMVJwY1Jlc3VsdCh1bnNhZmVSZXMpO1xuICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgcmVzLnJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgIHJldHVybiByZXMucmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCB0aGUgYWNjb3VudCBpbmZvIGZvciB0aGUgc3BlY2lmaWVkIHB1YmxpYyBrZXlcbiAgICovXG4gIGFzeW5jIGZldGNoQWNjb3VudERldGFpbChwdWJLZXk6IFB1YktleSk6IFByb21pc2U8QWNjb3VudERldGFpbD4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgnZ2V0QWNjb3VudEluZm8nLCBbXG4gICAgICBwdWJLZXkudG9CYXNlNTgoKSxcbiAgICBdKTtcbiAgICBjb25zdCByZXMgPSBmZXRjaEFjY291bnREZXRhaWxScGNSZXN1bHQodW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGNvbnN0IHtyZXN1bHR9ID0gcmVzO1xuICAgIGFzc2VydCh0eXBlb2YgcmVzdWx0ICE9PSAndW5kZWZpbmVkJyk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZXhlY3V0YWJsZTogcmVzdWx0LmV4ZWN1dGFibGUsXG4gICAgICBvd25lcjogbmV3IFB1YktleShyZXN1bHQub3duZXIpLFxuICAgICAgZGlmczogcmVzdWx0LmRpZnMsXG4gICAgICByZXB1dGF0aW9uczogcmVzdWx0LnJlcHV0YXRpb25zLFxuICAgICAgZGF0YTogQnVmZmVyLmZyb20ocmVzdWx0LmRhdGEpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29uZmlybSB0aGUgdHJhbnNhY3Rpb24gaWRlbnRpZmllZCBieSB0aGUgc3BlY2lmaWVkIHNpZ25hdHVyZVxuICAgKi9cbiAgYXN5bmMgY29uZm1UeG4oc2lnbmF0dXJlOiBUeG5TaWduYXR1cmUpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB1bnNhZmVSZXMgPSBhd2FpdCB0aGlzLl9ycGNSZXEoJ2NvbmZpcm1UeG4nLCBbc2lnbmF0dXJlXSk7XG4gICAgY29uc3QgcmVzID0gQ29uZm1UeG5ScGNSZXN1bHQodW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2Ygbm9kZXMgdGhhdCBhcmUgY3VycmVudGx5IHBhcnRpY2lwYXRpbmcgaW4gdGhlIGNsdXN0ZXJcbiAgICovXG4gIGFzeW5jIGZldGNoQ2x1c3Rlck5vZGVzKCk6IFByb21pc2U8QXJyYXk8Tm9kZUluZm8+PiB7XG4gICAgY29uc3QgdW5zYWZlUmVzID0gYXdhaXQgdGhpcy5fcnBjUmVxKCdnZXRDbHVzdGVyTm9kZXMnLCBbXSk7XG5cbiAgICAvLyBMZWdhY3kgdjAuMTUgcmVzcG9uc2UuICBUT0RPOiBSZW1vdmUgaW4gQXVndXN0IDIwMTlcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzXzAxNSA9IEdldENsdXN0ZXJOb2Rlc18wMTUodW5zYWZlUmVzKTtcbiAgICAgIGlmIChyZXNfMDE1LmVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdubycsIHJlc18wMTUuZXJyb3IpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzXzAxNS5lcnJvci5tZXNzYWdlKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNfMDE1LnJlc3VsdC5tYXAobm9kZSA9PiB7XG4gICAgICAgIG5vZGUucHVia2V5ID0gbm9kZS5pZDtcbiAgICAgICAgbm9kZS5pZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgcmV0dXJuIG5vZGU7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAvLyBOb3QgbGVnYWN5IGZvcm1hdFxuICAgIH1cbiAgICAvLyBFbmQgTGVnYWN5IHYwLjE1IHJlc3BvbnNlXG5cbiAgICBjb25zdCByZXMgPSBHZXRDbHVzdGVyTm9kZXModW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm4gdGhlIGxpc3Qgb2Ygbm9kZXMgdGhhdCBhcmUgY3VycmVudGx5IHBhcnRpY2lwYXRpbmcgaW4gdGhlIGNsdXN0ZXJcbiAgICovXG4gIGFzeW5jIGdldEVwb2NoVm90ZUFjY291bnRzKCk6IFByb21pc2U8QXJyYXk8Vm90ZUFjY291bnRJbmZvPj4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgnZ2V0RXBvY2hWb3RlQWNjb3VudHMnLCBbXSk7XG4gICAgY29uc3QgcmVzID0gR2V0RXBvY2hWb3RlQWNjb3VudHModW5zYWZlUmVzKTtcbiAgICAvL2NvbnN0IHJlcyA9IHVuc2FmZVJlcztcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCB0aGUgY3VycmVudCBzbG90IGxlYWRlciBvZiB0aGUgY2x1c3RlclxuICAgKi9cbiAgYXN5bmMgZmV0Y2hSb3VuZExlYWRlcigpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgnZ2V0Um91bmRMZWFkZXInLCBbXSk7XG4gICAgY29uc3QgcmVzID0gRmV0Y2hSb3VuZExlYWRlcih1bnNhZmVSZXMpO1xuICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgcmVzLnJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgIHJldHVybiByZXMucmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHRoZSBjdXJyZW50IHRyYW5zYWN0aW9uIGNvdW50IG9mIHRoZSBjbHVzdGVyXG4gICAqL1xuICBhc3luYyBmZXRjaFNpZ25hdHVyZVN0YXRlKFxuICAgIHNpZ25hdHVyZTogVHhuU2lnbmF0dXJlLFxuICApOiBQcm9taXNlPFNpZ25hdHVyZVBhc3MgfCBUeG5FcnIgfCBudWxsPiB7XG4gICAgY29uc3QgdW5zYWZlUmVzID0gYXdhaXQgdGhpcy5fcnBjUmVxKCdnZXRTaWduYXR1cmVTdGF0ZScsIFtzaWduYXR1cmVdKTtcbiAgICBjb25zdCByZXMgPSBGZXRjaFNpZ25hdHVyZVN0YXRlUnBjUmVzdWx0KHVuc2FmZVJlcyk7XG4gICAgaWYgKHJlcy5lcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5lcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiByZXMucmVzdWx0ICE9PSAndW5kZWZpbmVkJyk7XG4gICAgcmV0dXJuIHJlcy5yZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggdGhlIGN1cnJlbnQgdHJhbnNhY3Rpb24gY291bnQgb2YgdGhlIGNsdXN0ZXJcbiAgICovXG4gIGFzeW5jIGZldGNoVHhuQW1vdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgdW5zYWZlUmVzID0gYXdhaXQgdGhpcy5fcnBjUmVxKCdnZXRUeG5DbnQnLCBbXSk7XG4gICAgY29uc3QgcmVzID0gRmV0Y2hUeG5BbW91bnRScGNSZXN1bHQodW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gTnVtYmVyKHJlcy5yZXN1bHQpO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHRoZSBjdXJyZW50IHRvdGFsIGN1cnJlbmN5IHN1cHBseSBvZiB0aGUgY2x1c3RlclxuICAgKi9cbiAgYXN5bmMgZ2V0VG90YWxTdXBwbHkoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCB1bnNhZmVSZXMgPSBhd2FpdCB0aGlzLl9ycGNSZXEoJ2dldFRvdGFsU3VwcGx5JywgW10pO1xuICAgIGNvbnN0IHJlcyA9IEdldFRvdGFsU3VwcGx5UnBjUmVzdWx0KHVuc2FmZVJlcyk7XG4gICAgaWYgKHJlcy5lcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5lcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiByZXMucmVzdWx0ICE9PSAndW5kZWZpbmVkJyk7XG4gICAgcmV0dXJuIE51bWJlcihyZXMucmVzdWx0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCBhIHJlY2VudCBibG9ja2hhc2ggZnJvbSB0aGUgY2x1c3RlclxuICAgKi9cbiAgYXN5bmMgZmV0Y2hSZWNlbnRCbG9ja2hhc2goKTogUHJvbWlzZTxCbG9ja2hhc2hBbmRGZWVDYWxjdWxhdG9yPiB7XG4gICAgY29uc3QgdW5zYWZlUmVzID0gYXdhaXQgdGhpcy5fcnBjUmVxKCdnZXRMYXRlc3RCbG9ja2hhc2gnLCBbXSk7XG5cbiAgICAvLyBMZWdhY3kgdjAuMTUgcmVzcG9uc2UuICBUT0RPOiBSZW1vdmUgaW4gQXVndXN0IDIwMTlcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzXzAxNSA9IEdldFJlY2VudEJsb2NraGFzaF8wMTUodW5zYWZlUmVzKTtcbiAgICAgIGlmIChyZXNfMDE1LmVycm9yKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihyZXNfMDE1LmVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgICAgY29uc3QgW2Jsb2NraGFzaCwgZmVlQ2FsY3VsYXRvcl0gPSByZXNfMDE1LnJlc3VsdDtcbiAgICAgIGZlZUNhbGN1bGF0b3IudGFyZ2V0U2lnbmF0dXJlc1BlclNsb3QgPSA0MjtcbiAgICAgIGZlZUNhbGN1bGF0b3IudGFyZ2V0RGlmc1BlclNpZ25hdHVyZSA9XG4gICAgICAgIGZlZUNhbGN1bGF0b3IuZGlmc1BlclNpZ25hdHVyZTtcblxuICAgICAgcmV0dXJuIFtibG9ja2hhc2gsIGZlZUNhbGN1bGF0b3JdO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIC8vIE5vdCBsZWdhY3kgZm9ybWF0XG4gICAgfVxuICAgIC8vIEVuZCBMZWdhY3kgdjAuMTUgcmVzcG9uc2VcblxuICAgIGNvbnN0IHJlcyA9IEZldGNoUmVjZW50QmxvY2toYXNoKHVuc2FmZVJlcyk7XG4gICAgaWYgKHJlcy5lcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5lcnJvci5tZXNzYWdlKTtcbiAgICB9XG4gICAgYXNzZXJ0KHR5cGVvZiByZXMucmVzdWx0ICE9PSAndW5kZWZpbmVkJyk7XG4gICAgcmV0dXJuIHJlcy5yZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogUmVxdWVzdCBhbiBhbGxvY2F0aW9uIG9mIGRpZnMgdG8gdGhlIHNwZWNpZmllZCBhY2NvdW50XG4gICAqL1xuICBhc3luYyByZXFEcm9uZShcbiAgICB0bzogUHViS2V5LFxuICAgIGFtb3VudDogbnVtYmVyLFxuICApOiBQcm9taXNlPFR4blNpZ25hdHVyZT4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgncmVxdWVzdERpZicsIFtcbiAgICAgIHRvLnRvQmFzZTU4KCksXG4gICAgICBhbW91bnQsXG4gICAgXSk7XG4gICAgY29uc3QgcmVzID0gUmVxRHJvbmVScGNSZXN1bHQodW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gICAgLyoqXG4gICAqIFJlcXVlc3QgYW4gYWxsb2NhdGlvbiBvZiByZXB1dGF0aW9ucyB0byB0aGUgc3BlY2lmaWVkIGFjY291bnRcbiAgICovXG4gIGFzeW5jIHJlcURyb25lMShcbiAgICB0bzogUHViS2V5LFxuICAgIGFtb3VudDogbnVtYmVyLFxuICApOiBQcm9taXNlPFR4blNpZ25hdHVyZT4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgncmVxdWVzdERpZjEnLCBbXG4gICAgICB0by50b0Jhc2U1OCgpLFxuICAgICAgYW1vdW50LFxuICAgIF0pO1xuICAgIGNvbnN0IHJlcyA9IFJlcURyb25lMVJwY1Jlc3VsdCh1bnNhZmVSZXMpO1xuICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgcmVzLnJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgIHJldHVybiByZXMucmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFNpZ24gYW5kIHNlbmQgYSB0cmFuc2FjdGlvblxuICAgKi9cbiAgYXN5bmMgc2VuZFR4bihcbiAgICB0cmFuc2FjdGlvbjogVHJhbnNhY3Rpb24sXG4gICAgLi4uc2lnbmVyczogQXJyYXk8QnVzQWNjb3VudD5cbiAgKTogUHJvbWlzZTxUeG5TaWduYXR1cmU+IHtcbiAgICBmb3IgKDs7KSB7XG4gICAgICAvLyBBdHRlbXB0IHRvIHVzZSBhIHJlY2VudCBibG9ja2hhc2ggZm9yIHVwIHRvIDMwIHNlY29uZHNcbiAgICAgIGNvbnN0IHNlY29uZHMgPSBuZXcgRGF0ZSgpLmdldFNlY29uZHMoKTtcbiAgICAgIGlmIChcbiAgICAgICAgdGhpcy5fYmxvY2toYXNoSW5mby5yZWNlbnRQYWNrYWdlaGFzaCAhPSBudWxsICYmXG4gICAgICAgIHRoaXMuX2Jsb2NraGFzaEluZm8uc2Vjb25kcyA8IHNlY29uZHMgKyAzMFxuICAgICAgKSB7XG4gICAgICAgIHRyYW5zYWN0aW9uLnJlY2VudFBhY2thZ2VoYXNoID0gdGhpcy5fYmxvY2toYXNoSW5mby5yZWNlbnRQYWNrYWdlaGFzaDtcbiAgICAgICAgdHJhbnNhY3Rpb24uc2lnbiguLi5zaWduZXJzKTtcbiAgICAgICAgaWYgKCF0cmFuc2FjdGlvbi5zaWduYXR1cmUpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJyFzaWduYXR1cmUnKTsgLy8gc2hvdWxkIG5ldmVyIGhhcHBlblxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgdGhlIHNpZ25hdHVyZSBvZiB0aGlzIHRyYW5zYWN0aW9uIGhhcyBub3QgYmVlbiBzZWVuIGJlZm9yZSB3aXRoIHRoZVxuICAgICAgICAvLyBjdXJyZW50IHJlY2VudFBhY2thZ2VoYXNoLCBhbGwgZG9uZS5cbiAgICAgICAgY29uc3Qgc2lnbmF0dXJlID0gdHJhbnNhY3Rpb24uc2lnbmF0dXJlLnRvU3RyaW5nKCk7XG4gICAgICAgIGlmICghdGhpcy5fYmxvY2toYXNoSW5mby50cmFuc2FjdGlvblNpZ25hdHVyZXMuaW5jbHVkZXMoc2lnbmF0dXJlKSkge1xuICAgICAgICAgIHRoaXMuX2Jsb2NraGFzaEluZm8udHJhbnNhY3Rpb25TaWduYXR1cmVzLnB1c2goc2lnbmF0dXJlKTtcbiAgICAgICAgICBpZiAodGhpcy5fZGlzYWJsZUJsb2NraGFzaENhY2hpbmcpIHtcbiAgICAgICAgICAgIHRoaXMuX2Jsb2NraGFzaEluZm8uc2Vjb25kcyA9IC0xO1xuICAgICAgICAgIH1cbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBGZXRjaCBhIG5ldyBibG9ja2hhc2hcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgZm9yICg7Oykge1xuICAgICAgICBjb25zdCBbXG4gICAgICAgICAgcmVjZW50UGFja2FnZWhhc2gsXG4gICAgICAgICAgLy9mZWVDYWxjdWxhdG9yLFxuICAgICAgICBdID0gYXdhaXQgdGhpcy5mZXRjaFJlY2VudEJsb2NraGFzaCgpO1xuXG4gICAgICAgIGlmICh0aGlzLl9ibG9ja2hhc2hJbmZvLnJlY2VudFBhY2thZ2VoYXNoICE9IHJlY2VudFBhY2thZ2VoYXNoKSB7XG4gICAgICAgICAgdGhpcy5fYmxvY2toYXNoSW5mbyA9IHtcbiAgICAgICAgICAgIHJlY2VudFBhY2thZ2VoYXNoLFxuICAgICAgICAgICAgc2Vjb25kczogbmV3IERhdGUoKS5nZXRTZWNvbmRzKCksXG4gICAgICAgICAgICB0cmFuc2FjdGlvblNpZ25hdHVyZXM6IFtdLFxuICAgICAgICAgIH07XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGF0dGVtcHRzID09PSA1MCkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgICAgICAgIGBVbmFibGUgdG8gb2J0YWluIGEgbmV3IGJsb2NraGFzaCBhZnRlciAke0RhdGUubm93KCkgLVxuICAgICAgICAgICAgICBzdGFydFRpbWV9bXNgLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTbGVlcCBmb3IgYXBwcm94aW1hdGVseSBoYWxmIGEgc2xvdFxuICAgICAgICBhd2FpdCBzbGVlcCgoNTAwICogREVGQVVMVF9USUNLU19QRVJfU0xPVCkgLyBOVU1fVElDS1NfUEVSX1NFQyk7XG5cbiAgICAgICAgKythdHRlbXB0cztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCB3aXJlVHJhbnNhY3Rpb24gPSB0cmFuc2FjdGlvbi5zZXJpYWxpemUoKTtcbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kTmF0aXZlVHhuKHdpcmVUcmFuc2FjdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIGFzeW5jIGZ1bGxub2RlRXhpdCgpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCB1bnNhZmVSZXMgPSBhd2FpdCB0aGlzLl9ycGNSZXEoJ2Z1bGxub2RlUXVpdCcsIFtdKTtcbiAgICBjb25zdCByZXMgPSBqc29uUnBjUmVzdWx0KCdib29sZWFuJykodW5zYWZlUmVzKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cbiAgICBhc3NlcnQodHlwZW9mIHJlcy5yZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGEgdHJhbnNhY3Rpb24gdGhhdCBoYXMgYWxyZWFkeSBiZWVuIHNpZ25lZCBhbmQgc2VyaWFsaXplZCBpbnRvIHRoZVxuICAgKiB3aXJlIGZvcm1hdFxuICAgKi9cbiAgYXN5bmMgc2VuZE5hdGl2ZVR4bihcbiAgICByYXdUcmFuc2FjdGlvbjogQnVmZmVyLFxuICApOiBQcm9taXNlPFR4blNpZ25hdHVyZT4ge1xuICAgIGNvbnN0IHVuc2FmZVJlcyA9IGF3YWl0IHRoaXMuX3JwY1JlcSgnc2VuZFR4bicsIFtcbiAgICAgIFsuLi5yYXdUcmFuc2FjdGlvbl0sXG4gICAgXSk7XG4gICAgY29uc3QgcmVzID0gU2VuZFR4blJwY1Jlc3VsdCh1bnNhZmVSZXMpO1xuICAgIGlmIChyZXMuZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihyZXMuZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICAgIGFzc2VydCh0eXBlb2YgcmVzLnJlc3VsdCAhPT0gJ3VuZGVmaW5lZCcpO1xuICAgIGFzc2VydChyZXMucmVzdWx0KTtcbiAgICByZXR1cm4gcmVzLnJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX3dzT25PcGVuKCkge1xuICAgIHRoaXMuX3JwY1dlYlNvY2tDb25uZWN0ZWQgPSB0cnVlO1xuICAgIHRoaXMuX3VwZGF0ZVN1YnNjcmlwdGlvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX3dzT25FcnIoZXJyOiBFcnJvcikge1xuICAgIGNvbnNvbGUubG9nKCd3cyBlcnJvcjonLCBlcnIubWVzc2FnZSk7XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF93c09uQ2xvc2UoY29kZTogbnVtYmVyLCBtZXNzYWdlOiBzdHJpbmcpIHtcbiAgICAvLyAxMDAwIG1lYW5zIF9ycGNXZWJTb2NrLmNsb3NlKCkgd2FzIGNhbGxlZCBleHBsaWNpdGx5XG4gICAgaWYgKGNvZGUgIT09IDEwMDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCd3cyBjbG9zZTonLCBjb2RlLCBtZXNzYWdlKTtcbiAgICB9XG4gICAgdGhpcy5fcnBjV2ViU29ja0Nvbm5lY3RlZCA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEBwcml2YXRlXG4gICAqL1xuICBhc3luYyBfdXBkYXRlU3Vic2NyaXB0aW9ucygpIHtcbiAgICBjb25zdCBhY2NvdW50S2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX2FjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zKS5tYXAoXG4gICAgICBOdW1iZXIsXG4gICAgKTtcbiAgICBjb25zdCBwcm9ncmFtS2V5cyA9IE9iamVjdC5rZXlzKFxuICAgICAgdGhpcy5fY29udHJvbGxlckFjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zLFxuICAgICkubWFwKE51bWJlcik7XG4gICAgaWYgKGFjY291bnRLZXlzLmxlbmd0aCA9PT0gMCAmJiBwcm9ncmFtS2V5cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuX3JwY1dlYlNvY2suY2xvc2UoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoIXRoaXMuX3JwY1dlYlNvY2tDb25uZWN0ZWQpIHtcbiAgICAgIGZvciAobGV0IGlkIG9mIGFjY291bnRLZXlzKSB7XG4gICAgICAgIHRoaXMuX2FjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zW2lkXS5zdWJzY3JpcHRpb25JZCA9IG51bGw7XG4gICAgICB9XG4gICAgICBmb3IgKGxldCBpZCBvZiBwcm9ncmFtS2V5cykge1xuICAgICAgICB0aGlzLl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbaWRdLnN1YnNjcmlwdGlvbklkID0gbnVsbDtcbiAgICAgIH1cbiAgICAgIHRoaXMuX3JwY1dlYlNvY2suY29ubmVjdCgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGZvciAobGV0IGlkIG9mIGFjY291bnRLZXlzKSB7XG4gICAgICBjb25zdCB7c3Vic2NyaXB0aW9uSWQsIHB1YktleX0gPSB0aGlzLl9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF07XG4gICAgICBpZiAoc3Vic2NyaXB0aW9uSWQgPT09IG51bGwpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLl9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tcbiAgICAgICAgICAgIGlkXG4gICAgICAgICAgXS5zdWJzY3JpcHRpb25JZCA9IGF3YWl0IHRoaXMuX3JwY1dlYlNvY2suY2FsbCgnYWNjb3VudFN1YnNjcmliZScsIFtcbiAgICAgICAgICAgIHB1YktleSxcbiAgICAgICAgICBdKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBgYWNjb3VudFN1YnNjcmliZSBlcnJvciBmb3IgJHtwdWJLZXl9OiAke2Vyci5tZXNzYWdlfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBmb3IgKGxldCBpZCBvZiBwcm9ncmFtS2V5cykge1xuICAgICAgY29uc3Qge1xuICAgICAgICBzdWJzY3JpcHRpb25JZCxcbiAgICAgICAgY29udHJvbGxlcklkLFxuICAgICAgfSA9IHRoaXMuX2NvbnRyb2xsZXJBY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF07XG4gICAgICBpZiAoc3Vic2NyaXB0aW9uSWQgPT09IG51bGwpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbXG4gICAgICAgICAgICBpZFxuICAgICAgICAgIF0uc3Vic2NyaXB0aW9uSWQgPSBhd2FpdCB0aGlzLl9ycGNXZWJTb2NrLmNhbGwoJ3Byb2dyYW1TdWJzY3JpYmUnLCBbXG4gICAgICAgICAgICBjb250cm9sbGVySWQsXG4gICAgICAgICAgXSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgICAgYHByb2dyYW1TdWJzY3JpYmUgZXJyb3IgZm9yICR7Y29udHJvbGxlcklkfTogJHtlcnIubWVzc2FnZX1gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQHByaXZhdGVcbiAgICovXG4gIF93c09uQWNjb3VudE5vdGljZShub3RpZmljYXRpb246IE9iamVjdCkge1xuICAgIGNvbnN0IHJlcyA9IEFjY291bnROb3RpY2VSZXN1bHQobm90aWZpY2F0aW9uKTtcbiAgICBpZiAocmVzLmVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IocmVzLmVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyh0aGlzLl9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9ucykubWFwKE51bWJlcik7XG4gICAgZm9yIChsZXQgaWQgb2Yga2V5cykge1xuICAgICAgY29uc3Qgc3ViID0gdGhpcy5fYWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbaWRdO1xuICAgICAgaWYgKHN1Yi5zdWJzY3JpcHRpb25JZCA9PT0gcmVzLnN1YnNjcmlwdGlvbikge1xuICAgICAgICBjb25zdCB7cmVzdWx0fSA9IHJlcztcbiAgICAgICAgYXNzZXJ0KHR5cGVvZiByZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcblxuICAgICAgICBzdWIuY2FsbGJhY2soe1xuICAgICAgICAgIGV4ZWN1dGFibGU6IHJlc3VsdC5leGVjdXRhYmxlLFxuICAgICAgICAgIG93bmVyOiBuZXcgUHViS2V5KHJlc3VsdC5vd25lciksXG4gICAgICAgICAgZGlmczogcmVzdWx0LmRpZnMsXG4gICAgICAgICAgcmVwdXRhdGlvbnM6IHJlc3VsdC5yZXB1dGF0aW9ucyxcbiAgICAgICAgICBkYXRhOiBCdWZmZXIuZnJvbShyZXN1bHQuZGF0YSksXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBjYWxsYmFjayB0byBiZSBpbnZva2VkIHdoZW5ldmVyIHRoZSBzcGVjaWZpZWQgYWNjb3VudCBjaGFuZ2VzXG4gICAqXG4gICAqIEBwYXJhbSBwdWJsaWNrZXkgUHVibGljIGtleSBvZiB0aGUgYWNjb3VudCB0byBtb25pdG9yXG4gICAqIEBwYXJhbSBjYWxsYmFjayBGdW5jdGlvbiB0byBpbnZva2Ugd2hlbmV2ZXIgdGhlIGFjY291bnQgaXMgY2hhbmdlZFxuICAgKiBAcmV0dXJuIHN1YnNjcmlwdGlvbiBpZFxuICAgKi9cbiAgb25BY2NvdW50Q2hhbmdlKFxuICAgIHB1YktleTogUHViS2V5LFxuICAgIGNhbGxiYWNrOiBBY2NvdW50Q2hhbmdlQ2FsbGJhY2ssXG4gICk6IG51bWJlciB7XG4gICAgY29uc3QgaWQgPSArK3RoaXMuX2FjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25Db3VudGVyO1xuICAgIHRoaXMuX2FjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zW2lkXSA9IHtcbiAgICAgIHB1YktleTogcHViS2V5LnRvQmFzZTU4KCksXG4gICAgICBjYWxsYmFjayxcbiAgICAgIHN1YnNjcmlwdGlvbklkOiBudWxsLFxuICAgIH07XG4gICAgdGhpcy5fdXBkYXRlU3Vic2NyaXB0aW9ucygpO1xuICAgIHJldHVybiBpZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXJlZ2lzdGVyIGFuIGFjY291bnQgbm90aWZpY2F0aW9uIGNhbGxiYWNrXG4gICAqXG4gICAqIEBwYXJhbSBpZCBzdWJzY3JpcHRpb24gaWQgdG8gZGVyZWdpc3RlclxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlTGlzdGVuZXJPZkFjY291bnRDaGFuZ2UoaWQ6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICh0aGlzLl9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF0pIHtcbiAgICAgIGNvbnN0IHtzdWJzY3JpcHRpb25JZH0gPSB0aGlzLl9hY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF07XG4gICAgICBkZWxldGUgdGhpcy5fYWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbaWRdO1xuICAgICAgaWYgKHN1YnNjcmlwdGlvbklkICE9PSBudWxsKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5fcnBjV2ViU29jay5jYWxsKCdhY2NvdW50VW5zdWJzY3JpYmUnLCBbc3Vic2NyaXB0aW9uSWRdKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2FjY291bnRVbnN1YnNjcmliZSBlcnJvcjonLCBlcnIubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoaXMuX3VwZGF0ZVN1YnNjcmlwdGlvbnMoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIGFjY291bnQgY2hhbmdlIGlkOiAke2lkfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBAcHJpdmF0ZVxuICAgKi9cbiAgX3dzT25Qcm9ncmFtQWNjb3VudE5vdGlmaWNhdGlvbihub3RpZmljYXRpb246IE9iamVjdCkge1xuICAgIGNvbnN0IHJlcyA9IENvbnRyb2xsZXJBY2NvdW50Tm90aWNlUmVzdWx0KG5vdGlmaWNhdGlvbik7XG4gICAgaWYgKHJlcy5lcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKHJlcy5lcnJvci5tZXNzYWdlKTtcbiAgICB9XG5cbiAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXModGhpcy5fY29udHJvbGxlckFjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zKS5tYXAoXG4gICAgICBOdW1iZXIsXG4gICAgKTtcbiAgICBmb3IgKGxldCBpZCBvZiBrZXlzKSB7XG4gICAgICBjb25zdCBzdWIgPSB0aGlzLl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbaWRdO1xuICAgICAgaWYgKHN1Yi5zdWJzY3JpcHRpb25JZCA9PT0gcmVzLnN1YnNjcmlwdGlvbikge1xuICAgICAgICBjb25zdCB7cmVzdWx0fSA9IHJlcztcbiAgICAgICAgYXNzZXJ0KHR5cGVvZiByZXN1bHQgIT09ICd1bmRlZmluZWQnKTtcblxuICAgICAgICBzdWIuY2FsbGJhY2soe1xuICAgICAgICAgIGFjY291bnRJZDogcmVzdWx0WzBdLFxuICAgICAgICAgIGZldGNoQWNjb3VudERldGFpbDoge1xuICAgICAgICAgICAgZXhlY3V0YWJsZTogcmVzdWx0WzFdLmV4ZWN1dGFibGUsXG4gICAgICAgICAgICBvd25lcjogbmV3IFB1YktleShyZXN1bHRbMV0ub3duZXIpLFxuICAgICAgICAgICAgZGlmczogcmVzdWx0WzFdLmRpZnMsXG4gICAgICAgICAgICByZXB1dGF0aW9uczogcmVzdWx0WzFdLnJlcHV0YXRpb25zLFxuICAgICAgICAgICAgZGF0YTogQnVmZmVyLmZyb20ocmVzdWx0WzFdLmRhdGEpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgYSBjYWxsYmFjayB0byBiZSBpbnZva2VkIHdoZW5ldmVyIGFjY291bnRzIG93bmVkIGJ5IHRoZVxuICAgKiBzcGVjaWZpZWQgY29udHJvbGxlciBjaGFuZ2VcbiAgICpcbiAgICogQHBhcmFtIGNvbnRyb2xsZXJJZCBQdWJsaWMga2V5IG9mIHRoZSBjb250cm9sbGVyIHRvIG1vbml0b3JcbiAgICogQHBhcmFtIGNhbGxiYWNrIEZ1bmN0aW9uIHRvIGludm9rZSB3aGVuZXZlciB0aGUgYWNjb3VudCBpcyBjaGFuZ2VkXG4gICAqIEByZXR1cm4gc3Vic2NyaXB0aW9uIGlkXG4gICAqL1xuICBvbkNvbnRyb2xsZXJBY2NvdW50Q2hhbmdlKFxuICAgIGNvbnRyb2xsZXJJZDogUHViS2V5LFxuICAgIGNhbGxiYWNrOiBDb250cm9sbGVyQWNjb3VudENoYW5nZUNhbGxiYWNrLFxuICApOiBudW1iZXIge1xuICAgIGNvbnN0IGlkID0gKyt0aGlzLl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbkNvdW50ZXI7XG4gICAgdGhpcy5fY29udHJvbGxlckFjY291bnRDaGFuZ2VTdWJzY3JpcHRpb25zW2lkXSA9IHtcbiAgICAgIGNvbnRyb2xsZXJJZDogY29udHJvbGxlcklkLnRvQmFzZTU4KCksXG4gICAgICBjYWxsYmFjayxcbiAgICAgIHN1YnNjcmlwdGlvbklkOiBudWxsLFxuICAgIH07XG4gICAgdGhpcy5fdXBkYXRlU3Vic2NyaXB0aW9ucygpO1xuICAgIHJldHVybiBpZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXJlZ2lzdGVyIGFuIGFjY291bnQgbm90aWZpY2F0aW9uIGNhbGxiYWNrXG4gICAqXG4gICAqIEBwYXJhbSBpZCBzdWJzY3JpcHRpb24gaWQgdG8gZGVyZWdpc3RlclxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlQ29udHJvbGxlckFjY291bnRDaGFuZ2VMaXN0ZW5lcihpZDogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKHRoaXMuX2NvbnRyb2xsZXJBY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF0pIHtcbiAgICAgIGNvbnN0IHtzdWJzY3JpcHRpb25JZH0gPSB0aGlzLl9jb250cm9sbGVyQWNjb3VudENoYW5nZVN1YnNjcmlwdGlvbnNbaWRdO1xuICAgICAgZGVsZXRlIHRoaXMuX2NvbnRyb2xsZXJBY2NvdW50Q2hhbmdlU3Vic2NyaXB0aW9uc1tpZF07XG4gICAgICBpZiAoc3Vic2NyaXB0aW9uSWQgIT09IG51bGwpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCB0aGlzLl9ycGNXZWJTb2NrLmNhbGwoJ3Byb2dyYW1VbnN1YnNjcmliZScsIFtzdWJzY3JpcHRpb25JZF0pO1xuICAgICAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygncHJvZ3JhbVVuc3Vic2NyaWJlIGVycm9yOicsIGVyci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhpcy5fdXBkYXRlU3Vic2NyaXB0aW9ucygpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWNjb3VudCBjaGFuZ2UgaWQ6ICR7aWR9YCk7XG4gICAgfVxuICB9XG59XG4iXX0=