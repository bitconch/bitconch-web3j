{"version":3,"sources":["bpf-loader.test.js"],"names":["mockRpcEnabled","jest","setTimeout","test","console","log","connection","Connection","url","from","fs","readFile","data","BpfControllerLoader","load","controllerId","transaction","Transaction","add","keys","pubkey","pubKey","isSigner","isDebitable"],"mappings":";;;;;;;;AAEA;;AAEA;;AAMA;;AACA;;AACA;;AAEA,IAAI,CAACA,yBAAL,EAAqB;AACnB;AACAC,EAAAA,IAAI,CAACC,UAAL,CAAgB,MAAhB;AACD;;AAEDC,IAAI,CAAC,oBAAD;AAAA;AAAA;AAAA;AAAA,6BAAuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eACrBH,yBADqB;AAAA;AAAA;AAAA;;AAEvBI,UAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AAFuB;;AAAA;AAMnBC,UAAAA,UANmB,GAMN,IAAIC,eAAJ,CAAeC,QAAf,CANM;AAAA;AAAA,iBAON,4CAAmBF,UAAnB,EAA+B,IAA/B,CAPM;;AAAA;AAOnBG,UAAAA,IAPmB;AAAA;AAAA,iBAQNC,eAAGC,QAAH,CAAY,8BAAZ,CARM;;AAAA;AAQnBC,UAAAA,IARmB;AAAA;AAAA,iBASEC,yBAAoBC,IAApB,CAAyBR,UAAzB,EAAqCG,IAArC,EAA2CG,IAA3C,CATF;;AAAA;AASnBG,UAAAA,YATmB;AAUnBC,UAAAA,WAVmB,GAUL,IAAIC,gBAAJ,GAAkBC,GAAlB,CAAsB;AACxCC,YAAAA,IAAI,EAAE,CAAC;AAACC,cAAAA,MAAM,EAAEX,IAAI,CAACY,MAAd;AAAsBC,cAAAA,QAAQ,EAAE,IAAhC;AAAsCC,cAAAA,WAAW,EAAE;AAAnD,aAAD,CADkC;AAExCR,YAAAA,YAAY,EAAZA;AAFwC,WAAtB,CAVK;AAAA;AAAA,iBAcnB,yBAAeT,UAAf,EAA2BU,WAA3B,EAAwCP,IAAxC,CAdmB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAvB,GAAJ;AAiBAN,IAAI,CAAC,uBAAD;AAAA;AAAA;AAAA;AAAA,6BAA0B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eACxBH,yBADwB;AAAA;AAAA;AAAA;;AAE1BI,UAAAA,OAAO,CAACC,GAAR,CAAY,uBAAZ;AAF0B;;AAAA;AAMtBC,UAAAA,UANsB,GAMT,IAAIC,eAAJ,CAAeC,QAAf,CANS;AAAA;AAAA,iBAOT,4CAAmBF,UAAnB,EAA+B,MAA/B,CAPS;;AAAA;AAOtBG,UAAAA,IAPsB;AAAA;AAAA,iBAQTC,eAAGC,QAAH,CACjB,iDADiB,CARS;;AAAA;AAQtBC,UAAAA,IARsB;AAAA;AAAA,iBAWDC,yBAAoBC,IAApB,CAAyBR,UAAzB,EAAqCG,IAArC,EAA2CG,IAA3C,CAXC;;AAAA;AAWtBG,UAAAA,YAXsB;AAYtBC,UAAAA,WAZsB,GAYR,IAAIC,gBAAJ,GAAkBC,GAAlB,CAAsB;AACxCC,YAAAA,IAAI,EAAE,CAAC;AAACC,cAAAA,MAAM,EAAEX,IAAI,CAACY,MAAd;AAAsBC,cAAAA,QAAQ,EAAE,IAAhC;AAAsCC,cAAAA,WAAW,EAAE;AAAnD,aAAD,CADkC;AAExCR,YAAAA,YAAY,EAAZA;AAFwC,WAAtB,CAZQ;AAAA;AAAA,iBAgBtB,yBAAeT,UAAf,EAA2BU,WAA3B,EAAwCP,IAAxC,CAhBsB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAA1B,GAAJ","sourcesContent":["// @flow\n\nimport fs from 'mz/fs';\n\nimport {\n  Connection,\n  BpfControllerLoader,\n  Transaction,\n  sendAndconfmTx,\n} from '../src';\nimport {mockRpcEnabled} from './__mocks__/node-fetch';\nimport {url} from './url';\nimport {newAccountWithDifs} from './new-account-with-difs';\n\nif (!mockRpcEnabled) {\n  // The default of 5 seconds is too slow for live testing sometimes\n  jest.setTimeout(120000);\n}\n\ntest('load BPF C program', async () => {\n  if (mockRpcEnabled) {\n    console.log('non-live test skipped');\n    return;\n  }\n\n  const connection = new Connection(url);\n  const from = await newAccountWithDifs(connection, 1024);\n  const data = await fs.readFile('test/fixtures/noop-c/noop.so');\n  const controllerId = await BpfControllerLoader.load(connection, from, data);\n  const transaction = new Transaction().add({\n    keys: [{pubkey: from.pubKey, isSigner: true, isDebitable: true}],\n    controllerId,\n  });\n  await sendAndconfmTx(connection, transaction, from);\n});\n\ntest('load BPF Rust program', async () => {\n  if (mockRpcEnabled) {\n    console.log('non-live test skipped');\n    return;\n  }\n\n  const connection = new Connection(url);\n  const from = await newAccountWithDifs(connection, 100000);\n  const data = await fs.readFile(\n    'test/fixtures/noop-rust/solana_bpf_rust_noop.so',\n  );\n  const controllerId = await BpfControllerLoader.load(connection, from, data);\n  const transaction = new Transaction().add({\n    keys: [{pubkey: from.pubKey, isSigner: true, isDebitable: true}],\n    controllerId,\n  });\n  await sendAndconfmTx(connection, transaction, from);\n});\n"]}